<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1.0"><title>Web Bluetooth Power Meter</title><style>body{color:#fff;background-color:#121212;flex-direction:column;justify-content:center;align-items:center;height:100vh;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex}.container{text-align:center;background:#1e1e1e;border-radius:16px;min-width:320px;padding:2rem 3rem;box-shadow:0 8px 24px #00000080}h1{color:#f39c12;margin-bottom:1rem;font-size:1.8rem}button{color:#121212;cursor:pointer;background-color:#f39c12;border:none;border-radius:8px;padding:14px 28px;font-size:16px;font-weight:700;transition:all .3s}button:hover{background-color:#e67e22;transform:translateY(-2px);box-shadow:0 4px 10px #f39c124d}button:disabled{color:#888;cursor:not-allowed;box-shadow:none;background-color:#555;transform:translateY(0)}.power-display{margin:2rem 0;padding:1rem}.power-display span{color:#fff;font-size:7rem;font-weight:700;line-height:1}.power-display small{color:#aaa;margin-left:8px;font-size:1.5rem}#status{color:#bbb;height:20px;margin-top:1rem;font-style:italic}#device-name{color:#f39c12;margin-top:8px;font-weight:700}</style><body>

    <div class=container>
        <h1>Cycling Power Meter ðŸš´</h1>
        <div class=power-display>
            <span id=power-value>--</span>
            <small>Watts</small>
        </div>
        <button id=connectButton>Connect to Power Meter</button>
        <div id=export-buttons style=margin-top:1rem;display:none>
            <button id=exportJsonButton>Export JSON</button>
            <button id=exportCsvButton>Export CSV</button>
        </div>
        <p id=status>Disconnected</p>
        <p id=device-name></p>
    </div>

    <script>let connectButton=document.getElementById("connectButton"),statusText=document.getElementById("status"),powerValueElement=document.getElementById("power-value"),deviceNameElement=document.getElementById("device-name"),exportButtons=document.getElementById("export-buttons"),exportJsonButton=document.getElementById("exportJsonButton"),exportCsvButton=document.getElementById("exportCsvButton"),powerData=[],lastPowerValue=0,dataLoggerInterval=null,powerMeterDevice=null,CYCLING_POWER_SERVICE_UUID="cycling_power",CYCLING_POWER_MEASUREMENT_CHARACTERISTIC_UUID="cycling_power_measurement";function handlePowerMeasurement(e){let t=parsePowerMeasurement(e.target.value);powerValueElement.textContent=t,lastPowerValue=t}function parsePowerMeasurement(e){return e.getInt16(2,!0)}function onDisconnected(){statusText.textContent="Device disconnected.",deviceNameElement.textContent="",powerValueElement.textContent="--",connectButton.disabled=!1,exportButtons.style.display="none",dataLoggerInterval&&(clearInterval(dataLoggerInterval),dataLoggerInterval=null),powerMeterDevice&&(powerMeterDevice.removeEventListener("gattserverdisconnected",onDisconnected),powerMeterDevice=null),lastPowerValue=0}connectButton.addEventListener("click",async()=>{if(!navigator.bluetooth){statusText.textContent="Web Bluetooth API is not available.";return}powerData=[],lastPowerValue=0,dataLoggerInterval&&clearInterval(dataLoggerInterval);try{statusText.textContent="Scanning for power meters...",powerMeterDevice=await navigator.bluetooth.requestDevice({filters:[{services:[CYCLING_POWER_SERVICE_UUID]}]}),statusText.textContent="Connecting to device...",deviceNameElement.textContent=`Device: ${powerMeterDevice.name||"Unknown Device"}`,powerMeterDevice.addEventListener("gattserverdisconnected",onDisconnected);let e=await powerMeterDevice.gatt.connect(),t=await e.getPrimaryService(CYCLING_POWER_SERVICE_UUID),n=await t.getCharacteristic("cycling_power_measurement");await n.startNotifications(),n.addEventListener("characteristicvaluechanged",handlePowerMeasurement),statusText.textContent="Connected and receiving data!",connectButton.disabled=!0,exportButtons.style.display="block",dataLoggerInterval=setInterval(()=>{powerData.push({timestamp:Date.now(),power:lastPowerValue})},100)}catch(e){statusText.textContent=`Error: ${e.message}`,console.error("Connection failed:",e),powerMeterDevice&&powerMeterDevice.removeEventListener("gattserverdisconnected",onDisconnected)}}),exportJsonButton.addEventListener("click",()=>{let e=new Blob([JSON.stringify(powerData,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let o=new Date,a=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0"),l=`${a}-${r}-${c}`;n.download=`power_data_${l}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}),exportCsvButton.addEventListener("click",()=>{let e="timestamp,power\n";powerData.forEach(t=>{e+=`${t.timestamp},${t.power}
`});let t=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n;let a=new Date,r=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),i=`${r}-${c}-${l}`;o.download=`power_data_${i}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)});</script>



