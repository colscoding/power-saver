let e,t,n,a,r,o,i,c,s,l,d,u,m,g,p,h,v,w,f,y;class A{constructor(){this.banner=null,this.waitingWorker=null}createBanner(){let e=document.createElement("div");return e.id="pwaUpdateBanner",e.className="pwa-update-banner",e.innerHTML=`
            <div class="pwa-update-content">
                <div class="pwa-update-icon">\u{1F504}</div>
                <div class="pwa-update-text">
                    <strong>Update Available</strong>
                    <span>A new version is ready to install</span>
                </div>
                <div class="pwa-update-actions">
                    <button id="pwaUpdateButton" class="pwa-btn pwa-btn-primary">Update Now</button>
                    <button id="pwaUpdateLater" class="pwa-btn pwa-btn-secondary">Later</button>
                </div>
            </div>
        `,e}show(e){this.waitingWorker=e,this.banner||(this.banner=this.createBanner(),document.body.appendChild(this.banner),this.attachEventListeners()),setTimeout(()=>{this.banner.classList.add("pwa-update-banner-visible")},500)}hide(){this.banner&&(this.banner.classList.remove("pwa-update-banner-visible"),setTimeout(()=>{this.banner&&this.banner.parentNode&&(this.banner.parentNode.removeChild(this.banner),this.banner=null)},300))}attachEventListeners(){let e=this.banner.querySelector("#pwaUpdateButton"),t=this.banner.querySelector("#pwaUpdateLater");e.addEventListener("click",()=>this.handleUpdateClick()),t.addEventListener("click",()=>this.handleLaterClick())}handleUpdateClick(){if(!this.waitingWorker)return void console.log("[PWA] No waiting worker to activate");this.waitingWorker.postMessage({type:"SKIP_WAITING"}),this.showUpdatingMessage(),setTimeout(()=>{window.location.reload()},1e3)}handleLaterClick(){this.hide()}showUpdatingMessage(){this.hide();let e=document.createElement("div");e.className="pwa-toast pwa-toast-info",e.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">\u{1F504}</span>
                <span>Updating app...</span>
            </div>
        `,document.body.appendChild(e),setTimeout(()=>e.classList.add("pwa-toast-visible"),100)}}let b=null,C=null,E=null;var S={};S=import.meta.resolve("7qU26");const I="powerMeterSession";function D(e){try{let t={timestamp:Date.now(),powerData:e.powerData,lastPowerValue:e.lastPowerValue,lastHeartRateValue:e.lastHeartRateValue,lastCadenceValue:e.lastCadenceValue,sessionStartTime:e.sessionStartTime,additionalSensorsData:e.additionalSensorsData||{}};localStorage.setItem(I,JSON.stringify(t))}catch(e){console.warn("Failed to save session data:",e)}}function x(){localStorage.removeItem(I)}const k={"10s":1e4,"20s":2e4,"30s":3e4,"40s":4e4,"50s":5e4,"1m":6e4,"2m":12e4,"3m":18e4,"4m":24e4,"5m":3e5};let L=[];const B=[],T=[];let M={"10s":{current:0,best:0},"20s":{current:0,best:0},"30s":{current:0,best:0},"40s":{current:0,best:0},"50s":{current:0,best:0},"1m":{current:0,best:0},"2m":{current:0,best:0},"3m":{current:0,best:0},"4m":{current:0,best:0},"5m":{current:0,best:0}};function N(){if(e)try{e.textContent=M["10s"].current||"--",t.textContent=M["10s"].best||"--",n.textContent=M["20s"].current||"--",a.textContent=M["20s"].best||"--",r.textContent=M["30s"].current||"--",o.textContent=M["30s"].best||"--",i.textContent=M["40s"].current||"--",c.textContent=M["40s"].best||"--",s.textContent=M["50s"].current||"--",l.textContent=M["50s"].best||"--",d.textContent=M["1m"].current||"--",u.textContent=M["1m"].best||"--",m.textContent=M["2m"].current||"--",g.textContent=M["2m"].best||"--",p.textContent=M["3m"].current||"--",h.textContent=M["3m"].best||"--",v.textContent=M["4m"].current||"--",w.textContent=M["4m"].best||"--",f.textContent=M["5m"].current||"--",y.textContent=M["5m"].best||"--"}catch(e){console.error("Error updating power averages display:",e.message)}}function U(){for(let e of(L=[],Object.keys(M)))M[e].current=0,M[e].best=0;N()}const P={powerValueElement:null,hrValueElement:null,cadenceValueElement:null,deviceNameElement:null,hrDeviceName:null,cadenceDeviceName:null,statusText:null,hrStatusText:null,cadenceStatusText:null,hrConnectionStatus:null,cadenceConnectionStatus:null,powerMeterConnectButton:null,hrConnectButton:null,speedCadenceConnectButton:null,exportButtons:{json:null,csv:null,tcx:null,image:null,clearSession:null},powerAveragesSection:null,hamburgerBtn:null,menuDropdown:null,powerAveragesToggle:null,powerMetricToggle:null,heartRateMetricToggle:null,cadenceMetricToggle:null,showInfoMenuItem:null,powerCard:null,heartRateCard:null,cadenceCard:null};function Q(e){if(!P.powerValueElement)return;let t=e||"--";P.powerValueElement.textContent=t,P.powerValueElement.setAttribute("data-value",t)}function R(){Q("--"),P.hrValueElement&&(P.hrValueElement.textContent="--"),P.cadenceValueElement&&(P.cadenceValueElement.textContent="--")}function V(){let e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`}function W(e){if(!e||!(e instanceof DataView))throw Error("Invalid heart rate data: value must be a DataView");if(e.byteLength<2)throw Error(`Invalid heart rate data: insufficient data (${e.byteLength} bytes)`);if((1&e.getUint8(0))!=0){if(e.byteLength<3)throw Error(`Invalid heart rate data: insufficient data for UINT16 format (${e.byteLength} bytes)`);let t=e.getUint16(1,!0);return t>300&&console.warn(`Unusually high heart rate detected: ${t} BPM`),t}let t=e.getUint8(1);return t>250&&console.warn(`Unusually high heart rate detected: ${t} BPM`),t}async function z(){if(!("wakeLock"in navigator))return console.warn("Wake Lock API is not supported in this browser"),!1;try{return(await navigator.wakeLock.request("screen")).addEventListener("release",()=>{console.log("Screen wake lock was released")}),console.log("Screen wake lock acquired"),!0}catch(e){return console.error("Failed to acquire wake lock:",e.name,e.message),!1}}const F="cycling_power",Y="cycling_power_measurement",q="cycling_speed_and_cadence",O="csc_measurement";let $=null,H=null,J=null,j=null,Z=null,G=null,K=null,X=0,_=0,ee=null;async function et(e,t){if(await z(),!navigator.bluetooth)return e.onStatusUpdate("Web Bluetooth API is not available."),!1;try{if(e.onStatusUpdate("Scanning for power meters..."),$&&(j&&($.removeEventListener("gattserverdisconnected",j),j=null),$.gatt.connected&&$.gatt.disconnect(),$=null),!($=await navigator.bluetooth.requestDevice({filters:[{services:[F]}]})))throw Error("No device selected");e.onStatusUpdate("Connecting to device..."),t.deviceNameElement&&(t.deviceNameElement.textContent=`Device: ${$.name||"Unknown Device"}`),j=()=>{var n,a;n=e,a=t,n.onStatusUpdate("Power meter disconnected."),a.deviceNameElement&&(a.deviceNameElement.textContent=""),$&&j&&($.removeEventListener("gattserverdisconnected",j),j=null),$=null,n.onDisconnected()},$.addEventListener("gattserverdisconnected",j);let n=await $.gatt.connect(),a=await n.getPrimaryService(F),r=await a.getCharacteristic(Y);try{let e=await a.getCharacteristic("cycling_power_feature");await e.readValue()}catch{}return await r.startNotifications(),r.addEventListener("characteristicvaluechanged",t=>{!function(e,t){try{let n=e.target.value;if(!n||!(n instanceof DataView))return void console.error("Invalid power measurement data: value must be a DataView");if(n.byteLength<4)return void console.error(`Invalid power measurement data: insufficient data (${n.byteLength} bytes)`);let a=n.getInt16(2,!0);if(isNaN(a))return void console.error("Invalid power value: NaN");a>3e3?console.warn(`Unusually high power detected: ${a}W`):a<-500&&console.warn(`Unusually low power detected: ${a}W`),t.onPowerMeasurement(a)}catch(e){console.error("Error parsing power measurement data:",e.message)}}(t,e)}),e.onStatusUpdate("Connected and receiving data!"),!0}catch(t){return"NotFoundError"===t.name?e.onStatusUpdate("No device selected."):(e.onStatusUpdate(`Error: ${t.message}`),console.error("Power meter connection failed:",t)),$&&(j&&($.removeEventListener("gattserverdisconnected",j),j=null),$=null),!1}}async function en(e,t){if(await z(),!navigator.bluetooth)return e.onStatusUpdate("Web Bluetooth API is not available."),!1;try{if(e.onStatusUpdate("Scanning for devices..."),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Connecting..."),H){if(G&&K){try{G.removeEventListener("characteristicvaluechanged",K)}catch(e){console.warn("Error removing HR characteristic listener:",e)}K=null,G=null}Z&&(H.removeEventListener("gattserverdisconnected",Z),Z=null),H.gatt.connected&&H.gatt.disconnect(),H=null}if(!(H=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["device_information","battery_service"]})))throw Error("No device selected");return await ea(H,e,t),!0}catch(n){if("NotFoundError"===n.name?(e.onStatusUpdate("No device selected."),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Disconnected")):(e.onStatusUpdate(`Error: ${n.message}`),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Connection Failed"),console.error("Heart rate monitor connection failed:",n)),G&&K){try{G.removeEventListener("characteristicvaluechanged",K)}catch(e){}K=null,G=null}return H&&Z&&(H.removeEventListener("gattserverdisconnected",Z),Z=null),H=null,!1}}async function ea(e,t,n){t.onStatusUpdate("Connecting to device..."),Z=()=>{var e=t,a=n;if(e.onStatusUpdate("Heart rate monitor disconnected."),a.hrConnectionStatus&&(a.hrConnectionStatus.textContent="Disconnected"),a.hrDeviceName&&(a.hrDeviceName.textContent=""),G&&K){try{G.removeEventListener("characteristicvaluechanged",K)}catch(e){console.warn("Error removing HR characteristic listener on disconnect:",e)}K=null,G=null}H&&Z&&(H.removeEventListener("gattserverdisconnected",Z),Z=null),H=null,e.onHeartRateChange(0),e.onDisconnected&&e.onDisconnected()},e.addEventListener("gattserverdisconnected",Z);try{let a=e.gatt.connected?e.gatt:await e.gatt.connect(),r=await er(e);n.hrDeviceName&&(n.hrDeviceName.textContent=`Device: ${r}`);let o=await a.getPrimaryService("heart_rate");if(G=await o.getCharacteristic("heart_rate_measurement"),K)try{G.removeEventListener("characteristicvaluechanged",K)}catch(e){console.warn("Error removing old HR characteristic listener:",e)}await G.startNotifications(),K=e=>{!function(e,t){try{let n=e.target.value,a=W(n);if(isNaN(a)||a<0)return void console.error("Invalid heart rate value:",a);t.onHeartRateChange(a)}catch(e){console.error("Error parsing heart rate data:",e.message)}}(e,t)},G.addEventListener("characteristicvaluechanged",K),t.onStatusUpdate("Connected!"),n.hrConnectionStatus&&(n.hrConnectionStatus.textContent="Connected")}catch(t){if(G&&K){try{G.removeEventListener("characteristicvaluechanged",K)}catch(e){}K=null,G=null}throw e.removeEventListener("gattserverdisconnected",Z),Z=null,t}}async function er(e){let t=e.name||"Unknown Device";try{let n=e.gatt.connected?e.gatt:await e.gatt.connect();try{let e=await n.getPrimaryService("device_information"),a=await eo(e,"manufacturer_name_string");a&&(t+=` (${a})`);let r=await eo(e,"model_number_string");r&&(t+=` ${r}`)}catch(e){}}catch(e){}return e.id&&(t+=` [${e.id.slice(-6)}]`),t}async function eo(e,t){try{let n=await e.getCharacteristic(t),a=await n.readValue();return new TextDecoder().decode(a)}catch(e){return null}}async function ei(e,t){if(await z(),!navigator.bluetooth)return void e.onStatusUpdate("Web Bluetooth API is not available.");try{e.onStatusUpdate("Scanning for sensors..."),t.cadenceConnectionStatus&&(t.cadenceConnectionStatus.textContent="Connecting..."),ee&&(clearTimeout(ee),ee=null),X=0,_=0,J=await navigator.bluetooth.requestDevice({filters:[{services:[q]}]}),e.onStatusUpdate("Connecting to device..."),t.cadenceDeviceName&&(t.cadenceDeviceName.textContent=`Device: ${J.name}`),J.addEventListener("gattserverdisconnected",()=>{var n,a;n=e,a=t,n.onStatusUpdate("Device disconnected."),a.cadenceConnectionStatus&&(a.cadenceConnectionStatus.textContent="Disconnected"),a.cadenceDeviceName&&(a.cadenceDeviceName.textContent=""),J=null,n.onCadenceChange(0),n.onDisconnected&&n.onDisconnected(),ee&&(clearTimeout(ee),ee=null),X=0,_=0});let n=await J.gatt.connect(),a=await n.getPrimaryService(q),r=await a.getCharacteristic(O);return await r.startNotifications(),r.addEventListener("characteristicvaluechanged",t=>{!function(e,t){let n=e.target.value,a=n.getUint8(0),r=1;if(1&a&&(r+=6),2&a){let e=n.getUint16(r,!0),a=n.getUint16(r+2,!0);if(X>0){let n=e-X,r=(a-_)/1024;if(r>0){let e=Math.round(n/r*60);t.onCadenceChange(e),ee&&clearTimeout(ee),ee=setTimeout(()=>{t.onCadenceChange(0),ee=null},3e3)}}X=e,_=a}}(t,e)}),e.onStatusUpdate("Connected!"),t.cadenceConnectionStatus&&(t.cadenceConnectionStatus.textContent="Connected"),!0}catch(n){return e.onStatusUpdate(`Error: ${n.message}`),t.cadenceConnectionStatus&&(t.cadenceConnectionStatus.textContent="Connection Failed"),console.error("Speed/Cadence connection failed:",n),!1}}const ec={power:[],heartRate:[],cadence:[],speed:[]};async function es(e){if(!navigator.bluetooth)throw Error("Web Bluetooth API is not available.");let t=await navigator.bluetooth.requestDevice({filters:[{services:[F]}]});if(!t)throw Error("No device selected");let n=await t.gatt.connect(),a=await n.getPrimaryService(F),r=await a.getCharacteristic(Y),o=`power-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:o,type:"power",name:t.name||"Unknown Power Meter",device:t,lastValue:0,characteristic:r};return await r.startNotifications(),r.addEventListener("characteristicvaluechanged",n=>{let a=n.target.value;if(a&&a instanceof DataView&&a.byteLength>=4){let n=a.getInt16(2,!0);i.lastValue=n,e(o,n,t.name)}}),t.addEventListener("gattserverdisconnected",()=>{let e=ec.power.findIndex(e=>e.id===o);-1!==e&&ec.power.splice(e,1)}),i.disconnect=()=>{t.gatt.connected&&t.gatt.disconnect()},ec.power.push(i),i}async function el(e){if(!navigator.bluetooth)throw Error("Web Bluetooth API is not available.");let t=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}]});if(!t)throw Error("No device selected");let n=await t.gatt.connect(),a=await n.getPrimaryService("heart_rate"),r=await a.getCharacteristic("heart_rate_measurement"),o=`hr-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:o,type:"heartRate",name:t.name||"Unknown Heart Rate Monitor",device:t,lastValue:0,characteristic:r};return await r.startNotifications(),r.addEventListener("characteristicvaluechanged",n=>{let a=W(n.target.value);!isNaN(a)&&a>=0&&(i.lastValue=a,e(o,a,t.name))}),t.addEventListener("gattserverdisconnected",()=>{let e=ec.heartRate.findIndex(e=>e.id===o);-1!==e&&ec.heartRate.splice(e,1)}),i.disconnect=()=>{t.gatt.connected&&t.gatt.disconnect()},ec.heartRate.push(i),i}async function ed(e){if(!navigator.bluetooth)throw Error("Web Bluetooth API is not available.");let t=await navigator.bluetooth.requestDevice({filters:[{services:[q]}]});if(!t)throw Error("No device selected");let n=await t.gatt.connect(),a=await n.getPrimaryService(q),r=await a.getCharacteristic(O),o=`cadence-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:o,type:"cadence",name:t.name||"Unknown Cadence Sensor",device:t,lastValue:0,characteristic:r,lastCrankRevs:0,lastCrankTime:0,resetTimer:null};return await r.startNotifications(),r.addEventListener("characteristicvaluechanged",n=>{let a=n.target.value,r=a.getUint8(0),c=1;if(1&r&&(c+=6),2&r){let n=a.getUint16(c,!0),r=a.getUint16(c+2,!0);if(i.lastCrankRevs>0){let a=n-i.lastCrankRevs,c=(r-i.lastCrankTime)/1024;if(c>0){let n=Math.round(a/c*60);i.lastValue=n,e(o,n,t.name),i.resetTimer&&clearTimeout(i.resetTimer),i.resetTimer=setTimeout(()=>{i.lastValue=0,e(o,0,t.name),i.resetTimer=null},3e3)}}i.lastCrankRevs=n,i.lastCrankTime=r}}),t.addEventListener("gattserverdisconnected",()=>{let e=ec.cadence.findIndex(e=>e.id===o);-1!==e&&(ec.cadence[e].resetTimer&&clearTimeout(ec.cadence[e].resetTimer),ec.cadence.splice(e,1))}),i.disconnect=()=>{i.resetTimer&&(clearTimeout(i.resetTimer),i.resetTimer=null),t.gatt.connected&&t.gatt.disconnect()},ec.cadence.push(i),i}async function eu(e){if(!navigator.bluetooth)throw Error("Web Bluetooth API is not available.");let t=await navigator.bluetooth.requestDevice({filters:[{services:[q]}]});if(!t)throw Error("No device selected");let n=await t.gatt.connect(),a=await n.getPrimaryService(q),r=await a.getCharacteristic(O),o=`speed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:o,type:"speed",name:t.name||"Unknown Speed Sensor",device:t,lastValue:0,characteristic:r,lastWheelRevs:0,lastWheelTime:0,resetTimer:null,wheelCircumference:2.105};return await r.startNotifications(),r.addEventListener("characteristicvaluechanged",n=>{let a=n.target.value;if(1&a.getUint8(0)){let n=a.getUint32(1,!0),r=a.getUint16(5,!0);if(i.lastWheelRevs>0){let a=n-i.lastWheelRevs,c=(r-i.lastWheelTime)/1024;if(c>0){let n=a*i.wheelCircumference/c*3.6;i.lastValue=Math.round(10*n)/10,e(o,i.lastValue,t.name),i.resetTimer&&clearTimeout(i.resetTimer),i.resetTimer=setTimeout(()=>{i.lastValue=0,e(o,0,t.name),i.resetTimer=null},3e3)}}i.lastWheelRevs=n,i.lastWheelTime=r}}),t.addEventListener("gattserverdisconnected",()=>{let e=ec.speed.findIndex(e=>e.id===o);-1!==e&&(ec.speed[e].resetTimer&&clearTimeout(ec.speed[e].resetTimer),ec.speed.splice(e,1))}),i.disconnect=()=>{i.resetTimer&&(clearTimeout(i.resetTimer),i.resetTimer=null),t.gatt.connected&&t.gatt.disconnect()},ec.speed.push(i),i}function em(e){return void 0!==e.power&&e.power>0}function eg(e){let t={time:e=>`<Time>${new Date(e).toISOString()}</Time>`,heartRate:e=>`<HeartRateBpm>
      <Value>${Math.round(e)}</Value>
    </HeartRateBpm>`,cadence:e=>`<Cadence>${Math.round(e)}</Cadence>`,power:e=>{let t=Math.max(0,Math.min(2e3,Math.round(e)));return`<Extensions>
      <TPX xmlns="http://www.garmin.com/xmlschemas/ActivityExtension/v2">
        <Watts>${t}</Watts>
      </TPX>
    </Extensions>`}},n=Object.keys(t).map(n=>void 0===e[n]?"":t[n](e[n])).filter(Boolean).join("\n");return`<Trackpoint>
${n}
</Trackpoint>`}function ep(e){return{time:e.timestamp,...void 0!==e.power&&{power:e.power},...void 0!==e.heartRate&&{heartRate:e.heartRate},...void 0!==e.cadence&&{cadence:e.cadence}}}function eh(e){if(!e)throw Error("Power data is null or undefined");if(!Array.isArray(e))throw Error("Power data must be an array");if(0===e.length)throw Error("Power data array is empty");let t=e.filter(e=>!e||"object"!=typeof e||void 0===e.timestamp);if(t.length>0)throw Error(`Power data contains ${t.length} invalid item(s)`);return!0}function ev(e,t=null){eh(e);let n={mainSensors:e};t&&(n.additionalSensors=t),ey(new Blob([JSON.stringify(n,null,2)],{type:"application/json;charset=utf-8;"}),`power_data_${V()}.json`)}function ew(e,t=null){eh(e);let n="timestamp,power,heartRate,cadence",a=[];if(t){for(let[e,r]of Object.entries(t))for(let[t,o]of Object.entries(r))if(o&&o.name){let r=`${e}_${o.name.replace(/[,\s]/g,"_")}`;a.push({type:e,sensorId:t,columnName:r,readings:o.readings||[]}),n+=`,${r}`}}n+="\n",e.forEach(e=>{let t=e.timestamp??"",r=e.power??"",o=e.heartRate??"",i=e.cadence??"";for(let e of(n+=`${t},${r},${o},${i}`,a)){let a="";if(e.readings.length>0){let n=e.readings.reduce((e,n)=>{let a=Math.abs(e.timestamp-t);return Math.abs(n.timestamp-t)<a?n:e});1e3>Math.abs(n.timestamp-t)&&(a=n.value)}n+=`,${a}`}n+="\n"}),ey(new Blob([n],{type:"text/csv;charset=utf-8;"}),`power_data_${V()}.csv`)}function ef(e){eh(e);try{let t=function(e){if(!Array.isArray(e)||0===e.length)return"";let t=e.filter(e=>{var t;return e&&"object"==typeof e&&void 0!==(t=e.timestamp)&&!isNaN(new Date(t).getTime())});if(0===t.length)return"";let n=function(e){let t=[...e];for(;t.length>0&&!em(t[0]);)t.shift();for(;t.length>0&&!em(t[t.length-1]);)t.pop();return t}(t.map(ep).sort((e,t)=>e.time-t.time));if(0===n.length)return"";let a=n.map(eg).join("\n"),r=new Date(n[0].time).toISOString(),o=function(e){if(0===e.length)return 0;let t=e[0].time;return Math.round((e[e.length-1].time-t)/1e3)}(n);return`<?xml version="1.0" encoding="UTF-8"?>
<TrainingCenterDatabase
  xmlns="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2
    http://www.garmin.com/xmlschemas/TrainingCenterDatabasev2.xsd">
  <Activities>
    <Activity Sport="Biking">
      <Id>${r}</Id>
      <Lap StartTime="${r}">
        <TotalTimeSeconds>${o}</TotalTimeSeconds>
        <DistanceMeters>0</DistanceMeters>
        <Calories>0</Calories>
        <Intensity>Active</Intensity>
        <TriggerMethod>Manual</TriggerMethod>
        <Track>
${a}
        </Track>
      </Lap>
    </Activity>
  </Activities>
</TrainingCenterDatabase>`}(e);if(!t)throw Error("Failed to generate TCX content");let n=new Blob([t],{type:"application/vnd.garmin.tcx+xml;charset=utf-8;"});ey(n,`power_data_${V()}.tcx`)}catch(e){throw console.error("Error generating TCX:",e),e}}function ey(e,t){try{if(!e||!(e instanceof Blob))throw Error("Invalid blob provided for download");if(!t||"string"!=typeof t)throw Error("Invalid filename provided for download");let n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(e){throw console.error("Error during file download:",e),e}}async function eA(e){let{powerData:t,additionalSensorsData:n}=e;eh(t);let a=[];for(let{name:e,fn:r}of[{name:"Summary JSON",fn:()=>ev(t,n)},{name:"Summary CSV",fn:()=>ew(t,n)},{name:"TCX",fn:()=>ef(t)}]){try{r(),console.log(`\u{2713} ${e} exported`)}catch(t){a.push(`${e}: ${t.message}`)}await new Promise(e=>setTimeout(e,100))}if(a.length>0){let e=`Some exports failed:
${a.join("\n")}`;throw console.warn("Export errors:",a),Error(e)}console.log("✅ All exports completed successfully!")}function eb(e,t){let n=`Error during ${t} export: ${e.message}`;console.error(n,e),alert(n)}async function eC(){try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>(console.log("Deleting cache:",e),caches.delete(e)))),console.log("All caches cleared")}if(navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),navigator.serviceWorker)for(let e of(await navigator.serviceWorker.getRegistrations()))await e.unregister(),console.log("Service worker unregistered")}catch(e){console.error("Error clearing cache:",e)}}function eE(e,t){let n=document.createElement("div");return n.className="export-modal",n.innerHTML=`
        <div class="export-modal-content">
            <div class="export-modal-header">
                <h3 class="export-modal-title">${e}</h3>
                <button class="export-modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="export-modal-description">${t}</div>
            <div class="export-modal-buttons"></div>
        </div>
    `,n.querySelector(".export-modal-close").addEventListener("click",()=>eD(n)),n.addEventListener("click",e=>{e.target===n&&eD(n)}),n}function eS(e,t){let n=e.querySelector(".export-modal-buttons");t.forEach(e=>{let t=document.createElement("button");if(t.className=`export-modal-button ${e.className||""}`,t.disabled=e.disabled||!1,t.innerHTML=`
            <span>${e.text}</span>
            ${e.description?`<small style="opacity: 0.7; font-size: 0.8em;">${e.description}</small>`:""}
        `,t.addEventListener("click",e.onClick),n.appendChild(t),e.className&&e.className.includes("export-all")){let e=document.createElement("div");e.className="export-modal-separator",e.innerHTML="<span>Individual Exports</span>",n.appendChild(e)}})}function eI(e){document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("show")})}function eD(e){e.classList.remove("show"),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},300)}function ex(e,t,n=!0,a=null){let r=n;n?(e.classList.add("active"),t.style.display="block"):(e.classList.remove("active"),t.style.display="none");let o=()=>{(r=!r)?(t.style.display="block",e.classList.add("active")):(t.style.display="none",e.classList.remove("active")),a&&a()};return e.addEventListener("click",o),()=>e.removeEventListener("click",o)}function ek(){let e=document.querySelector(".dashboard");if(!e)return;let t=document.querySelector(".collapsed-sections-row");t&&(t.querySelectorAll(".power-averages-section").forEach(t=>{e.parentNode.insertBefore(t,e.nextSibling)}),t.remove()),e.classList.remove("has-collapsed-sections")}function eL(e,t){let n=document.createElement("div");n.className="metric-info-modal",n.innerHTML=`
        <div class="metric-info-content">
            <div class="metric-info-header">
                <h3>${e}</h3>
                <button class="metric-info-close" aria-label="Close">\xd7</button>
            </div>
            <div class="metric-info-body">
                <p>${t}</p>
            </div>
        </div>
    `,document.body.appendChild(n),setTimeout(()=>n.classList.add("active"),10);let a=n.querySelector(".metric-info-close"),r=()=>{n.classList.remove("active"),setTimeout(()=>n.remove(),300)};a.addEventListener("click",r),n.addEventListener("click",e=>{e.target===n&&r()});let o=e=>{"Escape"===e.key&&(r(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o)}const eB={power:{icon:"⚡",unit:"W",accentColor:"#f39c12",menuItemId:"connectAdditionalPowerMenuItem",connectFunction:es},heartRate:{icon:"❤️",unit:"bpm",accentColor:"#e74c3c",menuItemId:"connectAdditionalHeartRateMenuItem",connectFunction:el},cadence:{icon:"\uD83D\uDEB4",unit:"rpm",accentColor:"#3498db",menuItemId:"connectAdditionalCadenceMenuItem",connectFunction:ed},speed:{icon:"\uD83C\uDFC3",unit:"km/h",accentColor:"#2ecc71",menuItemId:"connectAdditionalSpeedMenuItem",connectFunction:eu}},eT={dark:{name:"Dark Elegance",icon:"\uD83C\uDF19",colors:{"--bg-primary":"linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 50%, #0c0c0c 100%)","--bg-secondary":"linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%)","--bg-card":"linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%)","--bg-additional-card":"linear-gradient(135deg, #1a1a1a 0%, #252525 100%)","--text-primary":"#ffffff","--text-secondary":"#999999","--border-color":"rgba(255, 255, 255, 0.1)","--shadow-color":"rgba(0, 0, 0, 0.4)","--accent-power":"#f39c12","--accent-hr":"#e74c3c","--accent-cadence":"#3498db","--accent-speed":"#2ecc71"}},light:{name:"Clean Light",icon:"☀️",colors:{"--bg-primary":"linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 50%, #f5f5f5 100%)","--bg-secondary":"linear-gradient(135deg, #ffffff 0%, #f8f8f8 100%)","--bg-card":"linear-gradient(135deg, #ffffff 0%, #fafafa 100%)","--bg-additional-card":"linear-gradient(135deg, #fefefe 0%, #f5f5f5 100%)","--text-primary":"#1a1a1a","--text-secondary":"#666666","--border-color":"rgba(0, 0, 0, 0.1)","--shadow-color":"rgba(0, 0, 0, 0.1)","--accent-power":"#e67e22","--accent-hr":"#c0392b","--accent-cadence":"#2980b9","--accent-speed":"#27ae60"}},blue:{name:"Ocean Blue",icon:"\uD83C\uDF0A",colors:{"--bg-primary":"linear-gradient(135deg, #0a1929 0%, #132f4c 50%, #0a1929 100%)","--bg-secondary":"linear-gradient(135deg, #1a2c42 0%, #253c54 100%)","--bg-card":"linear-gradient(135deg, #1e3a52 0%, #2a4a62 100%)","--bg-additional-card":"linear-gradient(135deg, #1a3448 0%, #253f56 100%)","--text-primary":"#e3f2fd","--text-secondary":"#90caf9","--border-color":"rgba(144, 202, 249, 0.2)","--shadow-color":"rgba(0, 0, 0, 0.5)","--accent-power":"#ffa726","--accent-hr":"#ef5350","--accent-cadence":"#42a5f5","--accent-speed":"#66bb6a"}},purple:{name:"Purple Haze",icon:"\uD83D\uDC9C",colors:{"--bg-primary":"linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 50%, #1a0a2e 100%)","--bg-secondary":"linear-gradient(135deg, #2d1b4e 0%, #3d2863 100%)","--bg-card":"linear-gradient(135deg, #3d2863 0%, #4d3673 100%)","--bg-additional-card":"linear-gradient(135deg, #331f56 0%, #432a66 100%)","--text-primary":"#f3e5f5","--text-secondary":"#ce93d8","--border-color":"rgba(206, 147, 216, 0.2)","--shadow-color":"rgba(0, 0, 0, 0.5)","--accent-power":"#ffb74d","--accent-hr":"#e57373","--accent-cadence":"#64b5f6","--accent-speed":"#81c784"}},neon:{name:"Neon Nights",icon:"⚡",colors:{"--bg-primary":"linear-gradient(135deg, #000000 0%, #1a0033 50%, #000000 100%)","--bg-secondary":"linear-gradient(135deg, #1a0033 0%, #2d004d 100%)","--bg-card":"linear-gradient(135deg, #2d004d 0%, #3d0066 100%)","--bg-additional-card":"linear-gradient(135deg, #240040 0%, #330055 100%)","--text-primary":"#00ff9f","--text-secondary":"#00ccff","--border-color":"rgba(0, 255, 159, 0.3)","--shadow-color":"rgba(0, 255, 159, 0.2)","--accent-power":"#00ff9f","--accent-hr":"#ff006e","--accent-cadence":"#00ccff","--accent-speed":"#ffbe0b"}},forest:{name:"Forest Green",icon:"\uD83C\uDF32",colors:{"--bg-primary":"linear-gradient(135deg, #0d1b0d 0%, #1a2f1a 50%, #0d1b0d 100%)","--bg-secondary":"linear-gradient(135deg, #1a2f1a 0%, #254025 100%)","--bg-card":"linear-gradient(135deg, #254025 0%, #305030 100%)","--bg-additional-card":"linear-gradient(135deg, #1f3a1f 0%, #2a452a 100%)","--text-primary":"#e8f5e9","--text-secondary":"#a5d6a7","--border-color":"rgba(165, 214, 167, 0.2)","--shadow-color":"rgba(0, 0, 0, 0.5)","--accent-power":"#ffa726","--accent-hr":"#ef5350","--accent-cadence":"#42a5f5","--accent-speed":"#66bb6a"}},sunset:{name:"Sunset Glow",icon:"\uD83C\uDF05",colors:{"--bg-primary":"linear-gradient(135deg, #1a0f0a 0%, #2d1510 50%, #1a0f0a 100%)","--bg-secondary":"linear-gradient(135deg, #3d241a 0%, #4d2f22 100%)","--bg-card":"linear-gradient(135deg, #4d2f22 0%, #5d3a28 100%)","--bg-additional-card":"linear-gradient(135deg, #432820 0%, #533326 100%)","--text-primary":"#fff3e0","--text-secondary":"#ffcc80","--border-color":"rgba(255, 204, 128, 0.2)","--shadow-color":"rgba(0, 0, 0, 0.5)","--accent-power":"#ff9800","--accent-hr":"#f44336","--accent-cadence":"#ff5722","--accent-speed":"#ffc107"}},mint:{name:"Mint Fresh",icon:"\uD83C\uDF3F",colors:{"--bg-primary":"linear-gradient(135deg, #e8f5f1 0%, #d4ebe3 50%, #e8f5f1 100%)","--bg-secondary":"linear-gradient(135deg, #ffffff 0%, #f0faf7 100%)","--bg-card":"linear-gradient(135deg, #f9fdfb 0%, #f0faf7 100%)","--bg-additional-card":"linear-gradient(135deg, #f5fcf9 0%, #ecf8f3 100%)","--text-primary":"#1a3a2e","--text-secondary":"#4a7c6a","--border-color":"rgba(26, 58, 46, 0.1)","--shadow-color":"rgba(0, 0, 0, 0.08)","--accent-power":"#f39c12","--accent-hr":"#e74c3c","--accent-cadence":"#3498db","--accent-speed":"#27ae60"}}},eM="powerSaverTheme";function eN(e){var t;eT[e]||(console.warn(`Theme "${e}" not found, using default dark theme`),e="dark");let n=document.documentElement;for(let[t,a]of Object.entries(eT[e].colors))n.style.setProperty(t,a);localStorage.setItem(eM,e),t=e,document.querySelectorAll(".theme-option").forEach(e=>{e.dataset.theme===t?(e.classList.add("active"),e.setAttribute("aria-pressed","true")):(e.classList.remove("active"),e.setAttribute("aria-pressed","false"))}),document.body.className=`theme-${e}`}function eU(){return localStorage.getItem(eM)||"dark"}function eP(){let e=function(){let e=document.createElement("div");e.className="modal-backdrop";let t=document.createElement("div");t.className="modal theme-selector-modal";let n=eU(),a="";for(let[e,t]of Object.entries(eT)){let r=e===n;a+=`
      <button class="theme-option ${r?"active":""}" 
              data-theme="${e}"
              role="button"
              aria-pressed="${r}"
              title="Switch to ${t.name}">
        <span class="theme-icon">${t.icon}</span>
        <span class="theme-name">${t.name}</span>
        <div class="theme-preview">
          <div class="preview-color" style="background: ${t.colors["--accent-power"]}"></div>
          <div class="preview-color" style="background: ${t.colors["--accent-hr"]}"></div>
          <div class="preview-color" style="background: ${t.colors["--accent-cadence"]}"></div>
          <div class="preview-color" style="background: ${t.colors["--accent-speed"]}"></div>
        </div>
      </button>
    `}return t.innerHTML=`
    <h3>\u{1F3A8} Choose Your Theme</h3>
    <p class="theme-description">Select a look that matches your style</p>
    <div class="theme-options-grid">
      ${a}
    </div>
    <button class="modal-button secondary close-theme-modal">Close</button>
  `,e.appendChild(t),t.querySelectorAll(".theme-option").forEach(e=>{e.addEventListener("click",()=>{eN(e.dataset.theme)})}),t.querySelector(".close-theme-modal").addEventListener("click",()=>{document.body.removeChild(e)}),e.addEventListener("click",t=>{t.target===e&&document.body.removeChild(e)}),e}();document.body.appendChild(e)}const eQ={classic:{name:"Classic",description:"Large power display with smaller side metrics",icon:"\uD83D\uDCCA",gridTemplate:"2fr 1fr 1fr",cardSizes:{power:{fontSize:"6rem",padding:"2rem"},hr:{fontSize:"3rem",padding:"1rem"},cadence:{fontSize:"3rem",padding:"1rem"}}},balanced:{name:"Balanced",description:"Equal size cards for all metrics",icon:"⚖️",gridTemplate:"1fr 1fr 1fr",cardSizes:{power:{fontSize:"4.5rem",padding:"1.5rem"},hr:{fontSize:"4.5rem",padding:"1.5rem"},cadence:{fontSize:"4.5rem",padding:"1.5rem"}}},vertical:{name:"Vertical Stack",description:"Single column with full-width cards",icon:"\uD83D\uDCF1",gridTemplate:"1fr",cardSizes:{power:{fontSize:"5rem",padding:"1.5rem"},hr:{fontSize:"4rem",padding:"1.5rem"},cadence:{fontSize:"4rem",padding:"1.5rem"}},responsive:!0},compact:{name:"Compact",description:"Dense layout for more screen space",icon:"\uD83D\uDCE6",gridTemplate:"1fr 1fr 1fr",cardSizes:{power:{fontSize:"3.5rem",padding:"0.75rem"},hr:{fontSize:"2.5rem",padding:"0.75rem"},cadence:{fontSize:"2.5rem",padding:"0.75rem"}},compact:!0},powerFocus:{name:"Power Focus",description:"Maximize power display, minimize others",icon:"⚡",gridTemplate:"3fr 1fr",cardSizes:{power:{fontSize:"8rem",padding:"2.5rem"},hr:{fontSize:"2rem",padding:"0.5rem"},cadence:{fontSize:"2rem",padding:"0.5rem"}},hideSecondary:!0},minimal:{name:"Minimal",description:"Clean minimal design with subtle cards",icon:"✨",gridTemplate:"1fr 1fr 1fr",cardSizes:{power:{fontSize:"5rem",padding:"1.5rem"},hr:{fontSize:"3.5rem",padding:"1.5rem"},cadence:{fontSize:"3.5rem",padding:"1.5rem"}},minimal:!0}};function eR(e){let t=eQ[e];if(!t)return void console.error(`Layout "${e}" not found`);let n=document.querySelector(".metrics-grid"),a=document.querySelector(".power-card"),r=document.querySelector(".hr-card"),o=document.querySelector(".cadence-card"),i=document.getElementById("power-value"),c=document.getElementById("hr-value"),s=document.getElementById("cadence-value");if(n){if(document.body.classList.remove("layout-classic","layout-balanced","layout-vertical","layout-compact","layout-power-focus","layout-minimal"),document.body.classList.add(`layout-${e.replace(/([A-Z])/g,"-$1").toLowerCase()}`),n.style.gridTemplateColumns=t.gridTemplate,a&&t.cardSizes.power&&(a.style.padding=t.cardSizes.power.padding),r&&t.cardSizes.hr&&(r.style.padding=t.cardSizes.hr.padding),o&&t.cardSizes.cadence&&(o.style.padding=t.cardSizes.cadence.padding),i&&t.cardSizes.power&&(i.style.fontSize=t.cardSizes.power.fontSize),c&&t.cardSizes.hr&&(c.style.fontSize=t.cardSizes.hr.fontSize),s&&t.cardSizes.cadence&&(s.style.fontSize=t.cardSizes.cadence.fontSize),t.hideSecondary){if(r&&o){n.style.gridTemplateColumns="3fr 1fr";let e=document.createElement("div");e.className="secondary-metrics-stack",e.style.display="grid",e.style.gap="4px",r.parentElement.classList.contains("secondary-metrics-stack")||(n.appendChild(e),e.appendChild(r),e.appendChild(o))}}else{let e=document.querySelector(".secondary-metrics-stack");if(e){let t=e.querySelector(".hr-card"),a=e.querySelector(".cadence-card");t&&n.appendChild(t),a&&n.appendChild(a),e.remove()}}localStorage.setItem("powerSaverLayout",e),console.log(`Layout changed to: ${t.name}`)}}function eV(){let e=localStorage.getItem("powerSaverLayout")||"classic",t=document.createElement("div");t.className="layout-selector-modal",t.innerHTML=`
        <div class="layout-selector-content">
            <div class="layout-selector-header">
                <h2>Choose Layout</h2>
                <button class="layout-selector-close" aria-label="Close">&times;</button>
            </div>
            <div class="layout-selector-grid">
                ${Object.entries(eQ).map(([t,n])=>`
                    <button class="layout-option ${t===e?"active":""}" data-layout="${t}">
                        <div class="layout-option-icon">${n.icon}</div>
                        <div class="layout-option-name">${n.name}</div>
                        <div class="layout-option-description">${n.description}</div>
                    </button>
                `).join("")}
            </div>
        </div>
    `,document.body.appendChild(t),t.addEventListener("click",e=>{e.target===t&&t.remove()}),t.querySelector(".layout-selector-close").addEventListener("click",()=>{t.remove()});let n=t.querySelectorAll(".layout-option");n.forEach(e=>{e.addEventListener("click",()=>{eR(e.getAttribute("data-layout")),n.forEach(e=>e.classList.remove("active")),e.classList.add("active"),setTimeout(()=>{t.remove()},300)})});let a=e=>{"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a)}let eW=[],ez=0,eF=0,eY=0,eq=null,eO=null,e$=null;const eH={power:{},heartRate:{},cadence:{},speed:{}},eJ={get powerData(){return eW},get lastPowerValue(){return ez},get lastHeartRateValue(){return eF},get lastCadenceValue(){return eY},get sessionStartTime(){return eq},get additionalSensorsData(){return eH},resetAllSessionData:function(){eW.length=0,U(),ez=0,eF=0,eY=0,eq=null,R(),x()},elements:P},ej={onPowerMeasurement:e=>{Q(e),ez=e,function(e){if("number"!=typeof e||isNaN(e))return console.error("Invalid power reading: must be a number",e);e>3e3?console.warn(`Unusually high power reading: ${e}W`):e<-500&&console.warn(`Unusually low power reading: ${e}W`);let t=Date.now();L.push({timestamp:t,power:e});let n=t-36e4;if(L=L.filter(e=>e.timestamp>n),B.push({timestamp:t,power:e}),B.length>0&&B[0].timestamp<=t-1e4){let e=Math.round(B.reduce((e,t)=>e+t.power,0)/B.length);for(T.push(e),B.splice(0,B.length);T.length>30;)T.shift();for(let[e,t]of Object.entries(k)){let n=Math.ceil(t/1e4);if(T.length>=n){let t=Math.round(T.slice(-n).reduce((e,t)=>e+t,0)/n);M[e].current=t,t>M[e].best&&(M[e].best=t)}else M[e].current=0}N()}}(e)},onDisconnected:()=>{R(),U(),eO&&(clearInterval(eO),eO=null),ez=0,eK()},onStatusUpdate:e=>{P.statusText&&(P.statusText.textContent=e)}},eZ={onHeartRateChange:e=>{P.hrValueElement&&(P.hrValueElement.textContent=e),eF=e},onStatusUpdate:e=>{P.hrStatusText&&(P.hrStatusText.textContent=e)},onDisconnected:()=>{eK()}},eG={onCadenceChange:e=>{P.cadenceValueElement&&(P.cadenceValueElement.textContent=e),eY=e},onStatusUpdate:e=>{P.cadenceStatusText&&(P.cadenceStatusText.textContent=e)},onDisconnected:()=>{eK()}};function eK(){var e;e={powerMeter:$&&$.gatt.connected,heartRate:H&&H.gatt.connected,speedCadence:J&&J.gatt.connected},P.powerMeterConnectButton&&(P.powerMeterConnectButton.style.display=e.powerMeter?"none":"block"),P.hrConnectButton&&(P.hrConnectButton.style.display=e.heartRate?"none":"block"),P.speedCadenceConnectButton&&(P.speedCadenceConnectButton.style.display=e.speedCadence?"none":"block")}function eX(e,t,n,a,r=!1){if(r){eH[a]&&delete eH[a][e];return}let o=Date.now();eH[a][e]||(eH[a][e]={name:n,readings:[]}),eH[a][e].readings.push({timestamp:o,value:t});let i=eH[a][e].readings;i.length>1e4&&i.splice(0,i.length-1e4);let c=document.getElementById(`sensor-card-${e}`);if(c){let e=c.querySelector(".additional-sensor-value");e&&(e.textContent=t)}}async function e_(){try{eN(eU()),eR(localStorage.getItem("powerSaverLayout")||"classic"),P.powerValueElement=document.getElementById("power-value"),P.hrValueElement=document.getElementById("hr-value"),P.cadenceValueElement=document.getElementById("cadence-value"),P.deviceNameElement=document.getElementById("device-name"),P.hrDeviceName=document.getElementById("hrDeviceName"),P.cadenceDeviceName=document.getElementById("cadenceDeviceName"),P.statusText=document.getElementById("status"),P.hrStatusText=document.getElementById("hrStatus"),P.cadenceStatusText=document.getElementById("cadenceStatus"),P.hrConnectionStatus=document.getElementById("hrConnectionStatus"),P.cadenceConnectionStatus=document.getElementById("cadenceConnectionStatus"),P.powerMeterConnectButton=document.getElementById("connectButton"),P.hrConnectButton=document.getElementById("hrConnectButton"),P.speedCadenceConnectButton=document.getElementById("speedCadenceConnectButton"),P.powerAveragesSection=document.getElementById("powerAveragesSection"),P.hamburgerBtn=document.getElementById("hamburgerButton"),P.menuDropdown=document.getElementById("menuDropdown"),P.powerAveragesToggle=document.getElementById("powerAveragesToggle"),P.powerMetricToggle=document.getElementById("powerMetricToggle"),P.heartRateMetricToggle=document.getElementById("heartRateMetricToggle"),P.cadenceMetricToggle=document.getElementById("cadenceMetricToggle"),P.showInfoMenuItem=document.getElementById("showInfoMenuItem"),P.powerCard=document.querySelector(".power-card"),P.heartRateCard=document.querySelector(".hr-card"),P.cadenceCard=document.querySelector(".cadence-card"),P.hrConnectionStatus&&(P.hrConnectionStatus.textContent="Disconnected"),P.cadenceConnectionStatus&&(P.cadenceConnectionStatus.textContent="Disconnected"),e=document.getElementById("avg10s-current"),t=document.getElementById("avg10s-best"),n=document.getElementById("avg20s-current"),a=document.getElementById("avg20s-best"),r=document.getElementById("avg30s-current"),o=document.getElementById("avg30s-best"),i=document.getElementById("avg40s-current"),c=document.getElementById("avg40s-best"),s=document.getElementById("avg50s-current"),l=document.getElementById("avg50s-best"),d=document.getElementById("avg1m-current"),u=document.getElementById("avg1m-best"),m=document.getElementById("avg2m-current"),g=document.getElementById("avg2m-best"),p=document.getElementById("avg3m-current"),h=document.getElementById("avg3m-best"),v=document.getElementById("avg4m-current"),w=document.getElementById("avg4m-best"),f=document.getElementById("avg5m-current"),y=document.getElementById("avg5m-best"),P.powerAveragesSection&&(P.powerAveragesSection.style.display="block");let A=document.querySelector(".dashboard"),b=document.getElementById("powerAveragesSection"),C=b&&"none"===b.style.display;A&&(C?A.classList.add("maximized"):A.classList.remove("maximized")),ek();let E=document.getElementById("powerIcon");E&&E.addEventListener("click",e=>{e.preventDefault(),eL("⚡ Power Output","Power output is measured in Watts and represents the amount of work you are doing on the bike. It is calculated by measuring the force applied to the pedals and the speed of pedaling. Higher power output means you are working harder. This metric is the most accurate way to measure cycling effort.")});let S=document.getElementById("hrIcon");S&&S.addEventListener("click",e=>{e.preventDefault(),eL("❤️ Heart Rate","Heart rate is measured in beats per minute (BPM) and indicates how hard your cardiovascular system is working. Your heart rate increases as exercise intensity increases. Monitoring heart rate helps you train in specific zones for different fitness goals. Connect a Bluetooth heart rate monitor to track this metric.")});let k=document.getElementById("cadenceIcon");k&&k.addEventListener("click",e=>{e.preventDefault(),eL("\uD83D\uDEB4 Cadence","Cadence is measured in revolutions per minute (RPM) and represents how fast you are pedaling. Most cyclists aim for a cadence between 80-100 RPM for optimal efficiency. Higher cadence with lower resistance can reduce muscle fatigue, while lower cadence with higher resistance builds strength. Connect a speed & cadence sensor to track this metric.")}),function(e){if(!e.hamburgerBtn||!e.menuDropdown)return console.error("Hamburger menu elements not found:",{hamburgerBtn:!!e.hamburgerBtn,menuDropdown:!!e.menuDropdown});e.hamburgerBtn.addEventListener("click",function(){e.menuDropdown.classList.contains("active")?e.menuDropdown.classList.remove("active"):e.menuDropdown.classList.add("active")}),document.addEventListener("click",function(t){t.target.closest(".hamburger-menu")||e.menuDropdown.classList.remove("active")})}(P),function(e){if(!e.powerAveragesToggle||!e.powerAveragesSection)return console.error("Power averages toggle elements not found:",{powerAveragesToggle:!!e.powerAveragesToggle,powerAveragesSection:!!e.powerAveragesSection});ex(e.powerAveragesToggle,e.powerAveragesSection,!0,ek)}(P),P.powerMetricToggle&&P.powerCard?ex(P.powerMetricToggle,P.powerCard,!0):console.error("Power metric toggle elements not found"),P.heartRateMetricToggle&&P.heartRateCard?ex(P.heartRateMetricToggle,P.heartRateCard,!0):console.error("Heart rate metric toggle elements not found"),P.cadenceMetricToggle&&P.cadenceCard?ex(P.cadenceMetricToggle,P.cadenceCard,!0):console.error("Cadence metric toggle elements not found");P.showInfoMenuItem?P.showInfoMenuItem.addEventListener("click",function(){!function(){let e=document.createElement("div");e.className="modal-backdrop",e.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    `;let t=document.createElement("div");t.className="modal",t.style.cssText=`
        background: #1a1a2e;
        border-radius: 12px;
        padding: 2rem;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        margin: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    `;let n=document.createElement("canvas");n.width=200,n.height=200,n.style.cssText=`
        background: white;
        border-radius: 8px;
        margin: 1rem auto;
        max-width: 100%;
        height: auto;
        display: block;
    `,t.innerHTML=`
        <div style="text-align: center; margin-bottom: 1.5rem;">
            <h2 style="color: #3498db; margin: 0 0 0.5rem 0; font-size: 1.8rem;">\u{1F6B4} Web Bluetooth Power Meter</h2>
            <p style="color: #cccccc; margin: 0; font-size: 1rem;">Real-time cycling data analysis</p>
        </div>

        <div style="color: #ffffff; line-height: 1.6;">
            <h3 style="color: #f39c12; margin: 1.5rem 0 1rem 0;">\u{1F4F1} Share This App</h3>
            <div style="text-align: center; margin-bottom: 1rem;">
                <div id="qr-container" style="margin: 1rem 0;"></div>
                <p style="color: #ffffff; margin: 0.5rem 0; font-weight: 600;">Scan to access on any device</p>
                <a href="https://colscoding.github.io/power-saver/" target="_blank" style="
                    color: #9b59b6; 
                    text-decoration: none; 
                    font-size: 0.9rem;
                    word-break: break-all;
                    line-height: 1.4;
                ">https://colscoding.github.io/power-saver/</a>
            </div>

            <h3 style="color: #f39c12; margin: 1.5rem 0 1rem 0;">\u{1F4F1} What is this app?</h3>
            <p style="margin-bottom: 1rem;">
                This is a web-based power meter application that connects to Bluetooth devices:
            </p>
            <ul style="margin: 0 0 1rem 1rem; padding-left: 1rem;">
                <li>cycling power meter</li>
                <li>cadence sensor</li>
                <li>heart rate sensor</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <button id="closeInfoModal" style="
                background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            ">Got it!</button>
        </div>
    `,t.querySelector("#qr-container").appendChild(n),function(e){let t=e.getContext("2d"),n=e.width;t.fillStyle="#ffffff",t.fillRect(0,0,n,n);let a=new Image;a.onload=function(){t.drawImage(a,0,0,n,n)},a.onerror=function(){var e=t,a=n;e.fillStyle="#000000",e.font="12px Arial",e.textAlign="center";let r=a/25;for(let t=0;t<25;t++)for(let n=0;n<25;n++)((t+n)%3==0||0===t||24===t||0===n||24===n)&&e.fillRect(t*r,n*r,r,r);e.fillStyle="#ffffff",e.fillRect(.2*a,.4*a,.6*a,.2*a),e.fillStyle="#000000",e.fillText("QR Code",a/2,a/2-10),e.fillText("Unavailable",a/2,a/2+10)},a.src="data:image/png;base64,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"}(n),e.appendChild(t),document.body.appendChild(e);let a=t.querySelector("#closeInfoModal"),r=()=>{document.body.removeChild(e)};a.addEventListener("click",r),e.addEventListener("click",t=>{t.target===e&&r()});let o=e=>{"Escape"===e.key&&(r(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o),a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-2px)",a.style.boxShadow="0 8px 24px rgba(52, 152, 219, 0.4)"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})}(),P.menuDropdown&&P.menuDropdown.classList.remove("active")}):console.error("Show info menu item not found");let L=document.getElementById("themeMenuItem");L&&eP&&L.addEventListener("click",function(){eP(),P.menuDropdown&&P.menuDropdown.classList.remove("active")});let B=document.getElementById("layoutMenuItem");B&&eV&&B.addEventListener("click",function(){eV(),P.menuDropdown&&P.menuDropdown.classList.remove("active")}),P.powerMeterConnectButton&&P.powerMeterConnectButton.addEventListener("click",async()=>{eW.length=0,ez=0,U(),eO&&clearInterval(eO),await et(ej,P)&&(eq||(eq=Date.now()),eO=setInterval(()=>{eW.push({timestamp:Date.now(),power:ez,heartRate:eF,cadence:eY}),eW.length%100==0&&D(eJ)},100),eK())}),P.hrConnectButton&&P.hrConnectButton.addEventListener("click",async()=>{await en(eZ,P)&&eK()}),P.speedCadenceConnectButton&&P.speedCadenceConnectButton.addEventListener("click",async()=>{await ei(eG,P)&&eK()});for(let[e,t]of Object.entries(eB)){let n=document.getElementById(t.menuItemId);n?n.addEventListener("click",async()=>{try{let n=await t.connectFunction((t,n,a)=>{eX(t,n,a,e)});!function(e,t,n){let a=document.getElementById("additionalSensorsSection"),r=document.getElementById("additionalSensorsGrid");if(!a||!r)return console.error("Additional sensors section not found");let o=eB[t];if(!o)return console.error(`Unknown sensor type: ${t}`);a.style.display="block";let i=document.createElement("div");i.className="additional-sensor-card",i.id=`sensor-card-${e.id}`,i.style.setProperty("--sensor-accent-color",o.accentColor),i.innerHTML=`
    <div class="additional-sensor-header">
      <span class="additional-sensor-type">${o.icon}</span>
      <span class="additional-sensor-name" title="${e.name}">${e.name}</span>
    </div>
    <div class="additional-sensor-value">${e.lastValue||0}</div>
    <div class="additional-sensor-unit">${o.unit}</div>
    <button class="disconnect-sensor-button" data-sensor-id="${e.id}">
      Disconnect
    </button>
  `,i.querySelector(".disconnect-sensor-button").addEventListener("click",()=>{var o=e.id;for(let e of["power","heartRate","cadence","speed"]){let t=ec[e].findIndex(e=>e.id===o);if(-1!==t){let n=ec[e][t];n.disconnect&&n.disconnect();break}}i.remove(),0===r.children.length&&(a.style.display="none"),n&&n(e.id,t)}),r.appendChild(i)}(n,e,(e,t)=>{eX(e,null,null,t,!0)}),P.menuDropdown&&P.menuDropdown.classList.remove("active")}catch(n){console.error(`Failed to connect additional ${e} sensor:`,n);let t=n.message;"NotFoundError"===n.name?t="No device selected or device not found.":"NotSupportedError"===n.name?t="Web Bluetooth is not supported on this device or browser.":"SecurityError"===n.name&&(t="Bluetooth access denied. Please check permissions."),alert(`Failed to connect additional ${e} sensor:
${t}`)}}):console.warn(`Menu item not found: ${t.menuItemId}`)}let T=document.getElementById("exportMenuItem");T&&T.addEventListener("click",()=>{let e=eE("\uD83D\uDCC4 Exports","Export your session data in various formats"),t=[{text:"\uD83D\uDCE5 Export All Files",description:"Download all export formats at once",className:"export-all primary",onClick:async()=>{try{await eA({powerData:eJ.powerData,additionalSensorsData:eJ.additionalSensorsData}),eD(e),alert("All export files downloaded successfully!")}catch(e){eb(e,"all files")}}},{text:"\uD83D\uDCCA Export JSON",description:"JavaScript Object Notation format",onClick:()=>{try{ev(eJ.powerData,eJ.additionalSensorsData),eD(e)}catch(e){eb(e,"JSON")}}},{text:"\uD83D\uDCCA Export CSV",description:"Comma-Separated Values format",onClick:()=>{try{ew(eJ.powerData,eJ.additionalSensorsData),eD(e)}catch(e){eb(e,"CSV")}}},{text:"\uD83C\uDFC3 Export TCX",description:"Training Center XML format",onClick:()=>{try{ef(eJ.powerData),eD(e)}catch(e){eb(e,"TCX")}}}];eS(e,t),eI(e)});let M=document.getElementById("exportUtilsMenuItem");M&&M.addEventListener("click",()=>{let e=eE("\uD83D\uDEE0️ Utilities","Session management and utilities"),t=[{text:"� Clear App Cache",description:"Clear cached files and force reload (ensures fresh version)",className:"primary",onClick:async()=>{confirm("This will clear the app cache and reload to get the latest version. Continue?")&&(await eC(),alert("Cache cleared! The page will now reload."),window.location.reload(!0))}},{text:"�\uD83D\uDDD1️ Clear Session Data",description:"Clear all session data (cannot be undone)",className:"danger",onClick:()=>{confirm("Are you sure you want to clear all session data? This action cannot be undone.")&&(eJ.resetAllSessionData(),alert("Session data cleared successfully!"),eD(e))}}];eS(e,t),eI(e)}),eK();let R=function(){try{let e=localStorage.getItem(I);if(!e)return null;let t=JSON.parse(e);if(!(t&&"object"==typeof t&&t.timestamp&&t.powerData&&Array.isArray(t.powerData)&&1))return console.warn("Invalid session data structure, clearing..."),localStorage.removeItem(I),null;if(Date.now()-t.timestamp>864e5)return console.log("Session expired, clearing..."),localStorage.removeItem(I),null;return t}catch(e){return console.warn("Failed to load session data:",e),localStorage.removeItem(I),null}}();R&&await new Promise(e=>{let t=document.createElement("div");t.className="modal-backdrop";let n=document.createElement("div");n.className="modal";let a=Math.round((Date.now()-R.timestamp)/6e4),r=R.powerData?.length||0;n.innerHTML=`
      <h3>Previous Session Found</h3>
      <p>
        A previous session was found from ${a} minutes ago with ${r} data points.
      </p>
      <p>
        Would you like to restore this session or start fresh?
      </p>
      <div class="modal-buttons">
        <button id="startFresh" class="modal-button secondary">Start Fresh</button>
        <button id="restoreSession" class="modal-button primary">Restore Session</button>
      </div>
    `,t.appendChild(n),document.body.appendChild(t),n.querySelector("#startFresh").addEventListener("click",()=>{document.body.removeChild(t),x(),e(!1)}),n.querySelector("#restoreSession").addEventListener("click",()=>{document.body.removeChild(t),e(!0)}),t.addEventListener("click",n=>{n.target===t&&(document.body.removeChild(t),e(!1))})})?function(e){try{var t;e.powerData&&(eW.length=0,eW.push(...e.powerData)),void 0!==e.lastPowerValue&&(ez=e.lastPowerValue),void 0!==e.lastHeartRateValue&&(eF=e.lastHeartRateValue),void 0!==e.lastCadenceValue&&(eY=e.lastCadenceValue),void 0!==e.sessionStartTime&&(eq=e.sessionStartTime),void 0!==(t={power:ez,heartRate:eF,cadence:eY}).power&&Q(t.power),void 0!==t.heartRate&&P.hrValueElement&&(P.hrValueElement.textContent=t.heartRate||"--"),void 0!==t.cadence&&P.cadenceValueElement&&(P.cadenceValueElement.textContent=t.cadence||"--"),N(),eW.length>0&&function(e){if(!document.getElementById("notification-styles")){let e=document.createElement("style");e.id="notification-styles",e.textContent=`
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `,document.head.appendChild(e)}let t=function(e,t){let n=document.createElement("div");return n.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${t};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        z-index: 1000;
        font-size: 0.9rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease-out;
        max-width: 300px;
        word-wrap: break-word;
    `,n.textContent=e,n}(`Session restored! ${e} data points recovered.`,"#4CAF50");document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideIn 0.3s ease-out reverse",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},5e3)}(eW.length)}catch(e){return console.warn("Failed to restore session data:",e),!1}}(R):eq=Date.now(),window.addEventListener("beforeunload",e0),e$=setInterval(()=>{eW.length>0&&D(eJ)},3e4)}catch(e){console.error("Failed to initialize application:",e),alert("Failed to initialize application. Please refresh the page.")}}function e0(){eW.length>0&&D(eJ),eO&&(clearInterval(eO),eO=null),e$&&(clearInterval(e$),e$=null)}document.addEventListener("DOMContentLoaded",e_),"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{let e=await navigator.serviceWorker.register(S,{updateViaCache:"none"});console.log("[PWA] Service Worker registered:",e.scope),e.update(),setInterval(()=>{console.log("[PWA] Checking for updates..."),e.update()},3e5),e.addEventListener("updatefound",()=>{let t=e.installing;console.log("[PWA] Update found, installing new service worker..."),t.addEventListener("statechange",()=>{var e;"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("[PWA] New version available"),e=t,console.log("[PWA] Update available. New version can be activated."),C||(C=new A),C.show(e)):console.log("[PWA] Content cached for offline use"))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[PWA] Controller changed, reloading page..."),window.location.reload()})}catch(e){console.error("[PWA] Service Worker registration failed:",e)}}):console.warn("[PWA] Service Workers are not supported in this browser"),b||(b=new class e{constructor(){this.banner=null,this.deferredPrompt=null}createBanner(){let e=document.createElement("div");return e.id="pwaInstallBanner",e.className="pwa-install-banner",e.innerHTML=`
            <div class="pwa-install-content">
                <div class="pwa-install-icon">\u{26A1}</div>
                <div class="pwa-install-text">
                    <strong>Install Power Meter</strong>
                    <span>Add to home screen for quick access</span>
                </div>
                <div class="pwa-install-actions">
                    <button id="pwaInstallButton" class="pwa-btn pwa-btn-primary">Install</button>
                    <button id="pwaInstallClose" class="pwa-btn pwa-btn-secondary">\xd7</button>
                </div>
            </div>
        `,e}show(e){this.isInstalled()||this.wasRecentlyDismissed()||(this.deferredPrompt=e,this.banner||(this.banner=this.createBanner(),document.body.appendChild(this.banner),this.attachEventListeners()),setTimeout(()=>{this.banner.classList.add("pwa-install-banner-visible")},500))}hide(){this.banner&&(this.banner.classList.remove("pwa-install-banner-visible"),setTimeout(()=>{this.banner&&this.banner.parentNode&&(this.banner.parentNode.removeChild(this.banner),this.banner=null)},300))}attachEventListeners(){let e=this.banner.querySelector("#pwaInstallButton"),t=this.banner.querySelector("#pwaInstallClose");e.addEventListener("click",()=>this.handleInstallClick()),t.addEventListener("click",()=>this.handleCloseClick())}async handleInstallClick(){if(!this.deferredPrompt)return void console.log("[PWA] Install prompt not available");this.deferredPrompt.prompt();let{outcome:e}=await this.deferredPrompt.userChoice;console.log(`[PWA] Install prompt outcome: ${e}`),this.hide(),this.deferredPrompt=null,"accepted"===e&&this.showThankYouMessage()}handleCloseClick(){this.hide(),localStorage.setItem("pwaInstallDismissed",Date.now().toString())}wasRecentlyDismissed(){let e=localStorage.getItem("pwaInstallDismissed");return!!e&&Date.now()-parseInt(e)<6048e5}isInstalled(){return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone}showThankYouMessage(){let e=document.createElement("div");e.className="pwa-toast pwa-toast-success",e.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">\u{2713}</span>
                <span>Thanks for installing! Launch from your home screen.</span>
            </div>
        `,document.body.appendChild(e),setTimeout(()=>e.classList.add("pwa-toast-visible"),100),setTimeout(()=>{e.classList.remove("pwa-toast-visible"),setTimeout(()=>e.remove(),300)},4e3)}}),window.addEventListener("beforeinstallprompt",e=>{console.log("[PWA] Install prompt available"),e.preventDefault(),b.show(e)}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App successfully installed"),b&&b.hide()}),setTimeout(()=>{!function(){let e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=!0===window.navigator.standalone;if(e&&!t){let e=localStorage.getItem("iosInstallDismissed");if(e&&Date.now()-parseInt(e)<2592e5)return;let t=document.createElement("div");t.className="pwa-ios-instructions",t.innerHTML=`
            <div class="pwa-ios-content">
                <div class="pwa-ios-header">
                    <span class="pwa-ios-icon">\u{1F4F1}</span>
                    <strong>Install Power Meter</strong>
                    <button class="pwa-ios-close" id="pwaIOSClose">\xd7</button>
                </div>
                <div class="pwa-ios-steps">
                    <p>Tap <strong>Share</strong> <span style="font-size: 1.2em;">\u{25A1}\u{2191}</span> then <strong>Add to Home Screen</strong></p>
                </div>
            </div>
        `,document.body.appendChild(t),setTimeout(()=>t.classList.add("pwa-ios-instructions-visible"),500),t.querySelector("#pwaIOSClose").addEventListener("click",()=>{t.classList.remove("pwa-ios-instructions-visible"),setTimeout(()=>t.remove(),300),localStorage.setItem("iosInstallDismissed",Date.now().toString())})}}()},2e3),E||(E=new class e{constructor(){this.indicator=null,this.isOnline=navigator.onLine}createIndicator(){let e=document.createElement("div");return e.id="pwaOfflineIndicator",e.className="pwa-offline-indicator",e.innerHTML=`
            <div class="pwa-offline-content">
                <span class="pwa-offline-icon">\u{1F4F4}</span>
                <span class="pwa-offline-text">You're offline</span>
            </div>
        `,e}init(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),navigator.onLine||this.handleOffline()}handleOnline(){this.isOnline=!0,console.log("[PWA] Connection restored"),this.hide(),this.showToast("✓","Back online","success")}handleOffline(){this.isOnline=!1,console.log("[PWA] Connection lost"),this.show()}show(){this.indicator||(this.indicator=this.createIndicator(),document.body.appendChild(this.indicator)),setTimeout(()=>{this.indicator.classList.add("pwa-offline-indicator-visible")},100)}hide(){this.indicator&&(this.indicator.classList.remove("pwa-offline-indicator-visible"),setTimeout(()=>{this.indicator&&this.indicator.parentNode&&(this.indicator.parentNode.removeChild(this.indicator),this.indicator=null)},300))}showToast(e,t,n="info"){let a=document.createElement("div");a.className=`pwa-toast pwa-toast-${n}`,a.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">${e}</span>
                <span>${t}</span>
            </div>
        `,document.body.appendChild(a),setTimeout(()=>a.classList.add("pwa-toast-visible"),100),setTimeout(()=>{a.classList.remove("pwa-toast-visible"),setTimeout(()=>a.remove(),300)},3e3)}}),E.init(),window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone?console.log("[PWA] Running as installed app"):console.log("[PWA] Running in browser");
//# sourceMappingURL=power-saver.b298f79d.js.map
