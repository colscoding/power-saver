let wakeLock=null;async function requestWakeLock(){if("wakeLock"in navigator)try{wakeLock=await navigator.wakeLock.request("screen"),console.log("Screen Wake Lock is active."),wakeLock.addEventListener("release",()=>{console.log("Screen Wake Lock was released.")})}catch(e){console.error(`${e.name}, ${e.message}`)}}async function releaseWakeLock(){null!==wakeLock&&(await wakeLock.release(),wakeLock=null)}let connectButton=document.getElementById("connectButton"),statusText=document.getElementById("status"),powerValueElement=document.getElementById("power-value"),deviceNameElement=document.getElementById("device-name"),exportButtons=document.getElementById("export-buttons"),exportJsonButton=document.getElementById("exportJsonButton"),exportCsvButton=document.getElementById("exportCsvButton"),exportRawJsonButton=document.getElementById("exportRawJsonButton"),exportRawCsvButton=document.getElementById("exportRawCsvButton"),avg10sCurrentElement=document.getElementById("avg10s-current"),avg10sBestElement=document.getElementById("avg10s-best"),avg30sCurrentElement=document.getElementById("avg30s-current"),avg30sBestElement=document.getElementById("avg30s-best"),avg1mCurrentElement=document.getElementById("avg1m-current"),avg1mBestElement=document.getElementById("avg1m-best"),avg2mCurrentElement=document.getElementById("avg2m-current"),avg2mBestElement=document.getElementById("avg2m-best"),avg4mCurrentElement=document.getElementById("avg4m-current"),avg4mBestElement=document.getElementById("avg4m-best"),toggleConnectSection=document.getElementById("toggleConnectSection"),toggleExportSection=document.getElementById("toggleExportSection"),connectSection=document.getElementById("connectSection"),exportSection=document.getElementById("exportSection"),powerAveragesSection=document.getElementById("powerAveragesSection"),connectToggleText=document.getElementById("connectToggleText"),exportToggleText=document.getElementById("exportToggleText"),hamburgerBtn=document.getElementById("hamburgerButton"),menuDropdown=document.getElementById("menuDropdown"),powerAveragesToggle=document.getElementById("powerAveragesToggle"),powerMetricToggle=document.getElementById("powerMetricToggle"),heartRateMetricToggle=document.getElementById("heartRateMetricToggle"),cadenceMetricToggle=document.getElementById("cadenceMetricToggle"),powerCard=document.querySelector(".power-card"),heartRateCard=document.querySelector(".hr-card"),cadenceCard=document.querySelector(".cadence-card");console.log("Hamburger elements:",{hamburgerBtn:hamburgerBtn,menuDropdown:menuDropdown,powerAveragesToggle:powerAveragesToggle,powerMetricToggle:powerMetricToggle,heartRateMetricToggle:heartRateMetricToggle,cadenceMetricToggle:cadenceMetricToggle}),console.log("Metric card elements:",{powerCard:powerCard,heartRateCard:heartRateCard,cadenceCard:cadenceCard});let balanceValueElement=document.getElementById("balance-value"),smoothnessValueElement=document.getElementById("smoothness-value"),torqueValueElement=document.getElementById("torque-value"),powerStatusIndicator=document.getElementById("power-status-indicator"),hrStatusIndicator=document.getElementById("hr-status-indicator"),cadenceStatusIndicator=document.getElementById("cadence-status-indicator"),speedStatusIndicator=document.getElementById("speed-status-indicator"),distanceStatusIndicator=document.getElementById("distance-status-indicator");if(powerStatusIndicator.className="status-indicator",hrStatusIndicator.className="status-indicator",cadenceStatusIndicator.className="status-indicator",speedStatusIndicator.className="status-indicator",distanceStatusIndicator.className="status-indicator",hamburgerBtn&&menuDropdown?(hamburgerBtn.addEventListener("click",function(){console.log("Hamburger button clicked"),menuDropdown.classList.contains("active")?(menuDropdown.classList.remove("active"),console.log("Menu dropdown hidden")):(menuDropdown.classList.add("active"),console.log("Menu dropdown shown"))}),document.addEventListener("click",function(e){e.target.closest(".hamburger-menu")||menuDropdown.classList.remove("active")})):console.error("Hamburger menu elements not found:",{hamburgerBtn:!!hamburgerBtn,menuDropdown:!!menuDropdown}),powerAveragesToggle&&powerAveragesSection){let e=!1;powerAveragesToggle.addEventListener("click",function(){console.log("Power averages toggle clicked"),(e=!e)?(powerAveragesSection.style.display="block",powerAveragesToggle.classList.add("active"),console.log("Power averages shown")):(powerAveragesSection.style.display="none",powerAveragesToggle.classList.remove("active"),console.log("Power averages hidden")),manageCollapsedSectionsLayout()})}else console.error("Power averages toggle elements not found:",{powerAveragesToggle:!!powerAveragesToggle,powerAveragesSection:!!powerAveragesSection});if(powerMetricToggle&&powerCard){let e=!0;powerMetricToggle.classList.add("active"),powerMetricToggle.addEventListener("click",function(){console.log("Power metric toggle clicked"),(e=!e)?(powerCard.style.display="block",powerMetricToggle.classList.add("active"),console.log("Power metric shown")):(powerCard.style.display="none",powerMetricToggle.classList.remove("active"),console.log("Power metric hidden"))})}else console.error("Power metric toggle elements not found:",{powerMetricToggle:!!powerMetricToggle,powerCard:!!powerCard});if(heartRateMetricToggle&&heartRateCard){let e=!0;heartRateMetricToggle.classList.add("active"),heartRateMetricToggle.addEventListener("click",function(){console.log("Heart rate metric toggle clicked"),(e=!e)?(heartRateCard.style.display="block",heartRateMetricToggle.classList.add("active"),console.log("Heart rate metric shown")):(heartRateCard.style.display="none",heartRateMetricToggle.classList.remove("active"),console.log("Heart rate metric hidden"))})}else console.error("Heart rate metric toggle elements not found:",{heartRateMetricToggle:!!heartRateMetricToggle,heartRateCard:!!heartRateCard});if(cadenceMetricToggle&&cadenceCard){let e=!0;cadenceMetricToggle.classList.add("active"),cadenceMetricToggle.addEventListener("click",function(){console.log("Cadence metric toggle clicked"),(e=!e)?(cadenceCard.style.display="block",cadenceMetricToggle.classList.add("active"),console.log("Cadence metric shown")):(cadenceCard.style.display="none",cadenceMetricToggle.classList.remove("active"),console.log("Cadence metric hidden"))})}else console.error("Cadence metric toggle elements not found:",{cadenceMetricToggle:!!cadenceMetricToggle,cadenceCard:!!cadenceCard});function updateDashboardLayout(){let e=document.querySelector(".dashboard");powerAveragesSection&&"none"===powerAveragesSection.style.display?e.classList.add("maximized"):e.classList.remove("maximized"),manageCollapsedSectionsLayout()}function manageCollapsedSectionsLayout(){let e=document.querySelector(".dashboard");[powerAveragesSection.classList.contains("collapsed")?powerAveragesSection:null].filter(e=>null!==e);let t=document.querySelector(".collapsed-sections-row");t&&(t.querySelectorAll(".power-averages-section").forEach(t=>{e.parentNode.insertBefore(t,e.nextSibling)}),t.remove()),e.classList.remove("has-collapsed-sections")}toggleConnectSection.addEventListener("click",()=>{let e=connectSection.querySelectorAll("button:not(.section-toggle-button)"),t=connectSection.querySelector(".section-header");"none"===e[0].style.display?(e.forEach(e=>e.style.display="block"),connectToggleText.textContent="Hide Connect Devices",toggleConnectSection.classList.remove("collapsed"),connectSection.classList.remove("collapsed"),t.classList.remove("collapsed")):(e.forEach(e=>e.style.display="none"),connectToggleText.textContent="Show Connect Devices",toggleConnectSection.classList.add("collapsed"),connectSection.classList.add("collapsed"),t.classList.add("collapsed"))}),toggleExportSection.addEventListener("click",()=>{let e=document.getElementById("export-buttons"),t=exportSection.querySelector(".section-header");"none"===e.style.display?(exportSection.style.display="block",e.style.display="flex",exportToggleText.textContent="Hide Export Data",toggleExportSection.classList.remove("collapsed"),exportSection.classList.remove("collapsed"),t.classList.remove("collapsed")):(e.style.display="none",exportToggleText.textContent="Show Export Data",toggleExportSection.classList.add("collapsed"),exportSection.classList.add("collapsed"),t.classList.add("collapsed"))});let connectButtons=connectSection.querySelectorAll("button:not(.section-toggle-button)");connectButtons.forEach(e=>e.style.display="block");let exportButtonsContainer=document.getElementById("export-buttons");exportSection.style.display="block",exportButtonsContainer.style.display="none",toggleExportSection.classList.add("collapsed"),exportSection.classList.add("collapsed"),exportSection.querySelector(".section-header").classList.add("collapsed"),powerAveragesSection.style.display="none",updateDashboardLayout();let powerData=[],rawPowerMeasurements=[],lastPowerValue=0,powerReadings=[],powerAverages={"10s":{current:0,best:0},"30s":{current:0,best:0},"1m":{current:0,best:0},"2m":{current:0,best:0},"4m":{current:0,best:0}};function addPowerReading(e){let t=Date.now();powerReadings.push({timestamp:t,power:e});let a=t-3e5;powerReadings=powerReadings.filter(e=>e.timestamp>a),calculatePowerAverages(),updatePowerAveragesDisplay()}function calculatePowerAverages(){let e=Date.now();for(let[t,a]of Object.entries({"10s":1e4,"30s":3e4,"1m":6e4,"2m":12e4,"4m":24e4})){let n=e-a,o=powerReadings.filter(e=>e.timestamp>=n);if(o.length>0){let e=Math.round(o.reduce((e,t)=>e+t.power,0)/o.length);powerAverages[t].current=e,e>powerAverages[t].best&&(powerAverages[t].best=e)}else powerAverages[t].current=0}}function updatePowerAveragesDisplay(){avg10sCurrentElement.textContent=powerAverages["10s"].current||"--",avg10sBestElement.textContent=powerAverages["10s"].best||"--",avg30sCurrentElement.textContent=powerAverages["30s"].current||"--",avg30sBestElement.textContent=powerAverages["30s"].best||"--",avg1mCurrentElement.textContent=powerAverages["1m"].current||"--",avg1mBestElement.textContent=powerAverages["1m"].best||"--",avg2mCurrentElement.textContent=powerAverages["2m"].current||"--",avg2mBestElement.textContent=powerAverages["2m"].best||"--",avg4mCurrentElement.textContent=powerAverages["4m"].current||"--",avg4mBestElement.textContent=powerAverages["4m"].best||"--"}function resetPowerAverages(){for(let e of(powerReadings=[],Object.keys(powerAverages)))powerAverages[e].current=0,powerAverages[e].best=0;updatePowerAveragesDisplay()}let lastHeartRateValue=0,lastCadenceValue=0,lastSpeedValue=0,lastBalanceValue=0,lastSmoothnessValue=0,lastTorqueValue=0,totalDistance=0,dataLoggerInterval=null,powerMeterDevice=null,CYCLING_POWER_SERVICE_UUID="cycling_power",CYCLING_POWER_MEASUREMENT_CHARACTERISTIC_UUID="cycling_power_measurement",CYCLING_POWER_FEATURE_CHARACTERISTIC_UUID="cycling_power_feature",CYCLING_CADENCE_SERVICE_UUID="cycling_speed_and_cadence",CSC_MEASUREMENT_CHARACTERISTIC_UUID="csc_measurement";function handlePowerMeasurement(e){let t=e.target.value,a={timestamp:Date.now(),flags:t.getUint16(0,!0),rawBytes:Array.from(new Uint8Array(t.buffer)).map(e=>e.toString(16).padStart(2,"0")).join(" "),dataLength:t.byteLength},n=t.getUint16(0,!0),o=2,r=t.getInt16(o,!0);if(a.instantaneousPower=r,powerValueElement.textContent=r,lastPowerValue=r,addPowerReading(r),o+=2,balanceValueElement.textContent="--",lastBalanceValue=0,smoothnessValueElement.textContent="--",lastSmoothnessValue=0,torqueValueElement.textContent="--",lastTorqueValue=0,a.pedalPowerBalance=null,a.accumulatedTorque=null,a.wheelRevolutionData=null,a.crankRevolutionData=null,a.extremeForceAngles=null,a.topBottomDeadSpotAngles=null,a.accumulatedEnergy=null,a.torqueEffectiveness=null,a.pedalSmoothness=null,1&n){let e=t.getUint8(o);a.pedalPowerBalance=e,balanceValueElement.textContent=`${100-e}/${e}`,lastBalanceValue=e,o+=1}if(4&n&&(a.accumulatedTorque=t.getUint16(o,!0),o+=2),16&n&&(a.wheelRevolutionData={cumulativeWheelRevolutions:t.getUint32(o,!0),lastWheelEventTime:t.getUint16(o+4,!0)},o+=6),32&n&&(a.crankRevolutionData={cumulativeCrankRevolutions:t.getUint16(o,!0),lastCrankEventTime:t.getUint16(o+2,!0)},o+=4),128&n&&(a.extremeForceAngles={maximumForceMagnitude:t.getInt16(o,!0),minimumForceMagnitude:t.getInt16(o+2,!0),maximumTorqueMagnitude:t.getInt16(o+4,!0)},o+=6),512&n&&(a.topBottomDeadSpotAngles={topDeadSpotAngle:t.getUint16(o,!0),bottomDeadSpotAngle:t.getUint16(o+2,!0)},o+=4),2048&n&&(a.accumulatedEnergy=t.getUint16(o,!0),o+=2),4096&n){let e=t.getUint8(o)/2,n=t.getUint8(o+2)/2;a.torqueEffectiveness=e,a.pedalSmoothness=n,torqueValueElement.textContent=e.toFixed(1),smoothnessValueElement.textContent=n.toFixed(1),lastTorqueValue=e,lastSmoothnessValue=n,o+=4}rawPowerMeasurements.push(a)}function parsePowerMeasurement(e){return e.getInt16(2,!0)}function onDisconnected(){statusText.textContent="Device disconnected.",powerStatusIndicator.className="status-indicator",deviceNameElement.textContent="",powerValueElement.textContent="--",balanceValueElement.textContent="--",smoothnessValueElement.textContent="--",torqueValueElement.textContent="--",resetPowerAverages(),connectButton.disabled=!1,dataLoggerInterval&&(clearInterval(dataLoggerInterval),dataLoggerInterval=null),powerMeterDevice&&(powerMeterDevice.removeEventListener("gattserverdisconnected",onDisconnected),powerMeterDevice=null),lastPowerValue=0,lastBalanceValue=0,lastSmoothnessValue=0,lastTorqueValue=0}connectButton.addEventListener("click",async()=>{if(await requestWakeLock(),!navigator.bluetooth){statusText.textContent="Web Bluetooth API is not available.";return}powerData=[],rawPowerMeasurements=[],lastPowerValue=0,resetPowerAverages(),dataLoggerInterval&&clearInterval(dataLoggerInterval);try{statusText.textContent="Scanning for power meters...",powerStatusIndicator.className="status-indicator connecting",powerMeterDevice=await navigator.bluetooth.requestDevice({filters:[{services:[CYCLING_POWER_SERVICE_UUID]}]}),statusText.textContent="Connecting to device...",deviceNameElement.textContent=`Device: ${powerMeterDevice.name||"Unknown Device"}`,powerMeterDevice.addEventListener("gattserverdisconnected",onDisconnected);let e=await powerMeterDevice.gatt.connect(),t=await e.getPrimaryService(CYCLING_POWER_SERVICE_UUID),a=await t.getCharacteristic("cycling_power_measurement");try{let e=await t.getCharacteristic("cycling_power_feature"),a=await e.readValue();console.log(`Power Features: ${a.getUint32(0,!0)}`)}catch(e){console.log("Cycling Power Feature characteristic not found.")}await a.startNotifications(),a.addEventListener("characteristicvaluechanged",handlePowerMeasurement),statusText.textContent="Connected and receiving data!",powerStatusIndicator.className="status-indicator connected",connectButton.disabled=!0,dataLoggerInterval=setInterval(()=>{powerData.push({timestamp:Date.now(),power:lastPowerValue,heartRate:lastHeartRateValue,cadence:lastCadenceValue,speed:lastSpeedValue,distance:totalDistance,balance:lastBalanceValue,smoothness:lastSmoothnessValue,torque:lastTorqueValue})},100)}catch(e){statusText.textContent=`Error: ${e.message}`,powerStatusIndicator.className="status-indicator",console.error("Connection failed:",e),powerMeterDevice&&powerMeterDevice.removeEventListener("gattserverdisconnected",onDisconnected)}}),exportJsonButton.addEventListener("click",()=>{let e=new Blob([JSON.stringify(powerData,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t;let n=new Date,o=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0"),s=`${o}-${r}-${c}`;a.download=`power_data_${s}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}),exportCsvButton.addEventListener("click",()=>{let e="timestamp,power,heartRate,cadence,speed,distance,balance,smoothness,torque\n";powerData.forEach(t=>{e+=`${t.timestamp},${t.power},${t.heartRate},${t.cadence},${t.speed},${t.distance},${t.balance||""},${t.smoothness||""},${t.torque||""}
`});let t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a;let o=new Date,r=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0"),l=`${r}-${c}-${s}`;n.download=`power_data_${l}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}),exportRawJsonButton.addEventListener("click",()=>{let e=new Blob([JSON.stringify(rawPowerMeasurements,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t;let n=new Date,o=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0"),s=`${o}-${r}-${c}`;a.download=`raw_power_measurements_${s}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}),exportRawCsvButton.addEventListener("click",()=>{let e="timestamp,flags,dataLength,instantaneousPower,pedalPowerBalance,accumulatedTorque,wheelRevolutions,wheelEventTime,crankRevolutions,crankEventTime,maxForceMagnitude,minForceMagnitude,maxTorqueMagnitude,topDeadSpotAngle,bottomDeadSpotAngle,accumulatedEnergy,torqueEffectiveness,pedalSmoothness,rawBytes\n";rawPowerMeasurements.forEach(t=>{let a=t.wheelRevolutionData?t.wheelRevolutionData.cumulativeWheelRevolutions:"",n=t.wheelRevolutionData?t.wheelRevolutionData.lastWheelEventTime:"",o=t.crankRevolutionData?t.crankRevolutionData.cumulativeCrankRevolutions:"",r=t.crankRevolutionData?t.crankRevolutionData.lastCrankEventTime:"",c=t.extremeForceAngles?t.extremeForceAngles.maximumForceMagnitude:"",s=t.extremeForceAngles?t.extremeForceAngles.minimumForceMagnitude:"",l=t.extremeForceAngles?t.extremeForceAngles.maximumTorqueMagnitude:"",d=t.topBottomDeadSpotAngles?t.topBottomDeadSpotAngles.topDeadSpotAngle:"",i=t.topBottomDeadSpotAngles?t.topBottomDeadSpotAngles.bottomDeadSpotAngle:"";e+=`${t.timestamp},${t.flags},${t.dataLength},${t.instantaneousPower},${t.pedalPowerBalance||""},${t.accumulatedTorque||""},${a},${n},${o},${r},${c},${s},${l},${d},${i},${t.accumulatedEnergy||""},${t.torqueEffectiveness||""},${t.pedalSmoothness||""},"${t.rawBytes}"
`});let t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a;let o=new Date,r=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0"),l=`${r}-${c}-${s}`;n.download=`raw_power_measurements_${l}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)});let heartData=[],hrDataLoggerInterval=null,hrConnectButton=document.getElementById("hrConnectButton"),hrStatusText=document.getElementById("hrStatus"),hrValue=document.getElementById("hr-value"),hrDeviceName=document.getElementById("hrDeviceName"),hrBluetoothDevice=null;function handleHeartRateChanged(e){let t=parseHeartRate(e.target.value);hrValue.textContent=t,lastHeartRateValue=t}function parseHeartRate(e){return 1&e.getUint8(0)?e.getUint16(1,!0):e.getUint8(1)}function onDisconnectedHr(){hrStatusText.textContent="Device disconnected.",hrStatusIndicator.className="status-indicator",hrDeviceName.textContent="",hrValue.textContent="--",hrConnectButton.disabled=!1,hrBluetoothDevice=null,lastHeartRateValue=0}hrConnectButton.addEventListener("click",async()=>{if(await requestWakeLock(),!navigator.bluetooth){hrStatusText.textContent="Web Bluetooth API is not available.";return}try{hrStatusText.textContent="Scanning for devices...",hrStatusIndicator.className="status-indicator connecting",hrBluetoothDevice=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}]}),hrStatusText.textContent="Connecting to device...",hrDeviceName.textContent=`Device: ${hrBluetoothDevice.name}`,hrBluetoothDevice.addEventListener("gattserverdisconnected",onDisconnectedHr);let e=await hrBluetoothDevice.gatt.connect(),t=await e.getPrimaryService("heart_rate"),a=await t.getCharacteristic("heart_rate_measurement");await a.startNotifications(),a.addEventListener("characteristicvaluechanged",handleHeartRateChanged),hrStatusText.textContent="Connected!",hrStatusIndicator.className="status-indicator connected",hrConnectButton.disabled=!0}catch(e){hrStatusText.textContent=`Error: ${e.message}`,hrStatusIndicator.className="status-indicator",console.error("Connection failed:",e)}});let speedCadenceConnectButton=document.getElementById("speedCadenceConnectButton"),cadenceValueElement=document.getElementById("cadence-value"),speedValueElement=document.getElementById("speed-value"),distanceValueElement=document.getElementById("distance-value"),cadenceStatusText=document.getElementById("cadenceStatus"),cadenceDeviceName=document.getElementById("cadenceDeviceName"),speedCadenceBluetoothDevice=null,WHEEL_CIRCUMFERENCE=2.105;speedCadenceConnectButton.addEventListener("click",async()=>{if(await requestWakeLock(),!navigator.bluetooth){cadenceStatusText.textContent="Web Bluetooth API is not available.";return}try{cadenceStatusText.textContent="Scanning for sensors...",cadenceStatusIndicator.className="status-indicator connecting",speedStatusIndicator.className="status-indicator connecting",speedCadenceBluetoothDevice=await navigator.bluetooth.requestDevice({filters:[{services:[CYCLING_CADENCE_SERVICE_UUID]}]}),cadenceStatusText.textContent="Connecting to device...",cadenceDeviceName.textContent=`Device: ${speedCadenceBluetoothDevice.name}`,speedCadenceBluetoothDevice.addEventListener("gattserverdisconnected",onDisconnectedSpeedCadence);let e=await speedCadenceBluetoothDevice.gatt.connect(),t=await e.getPrimaryService(CYCLING_CADENCE_SERVICE_UUID),a=await t.getCharacteristic("csc_measurement");await a.startNotifications(),a.addEventListener("characteristicvaluechanged",handleSpeedCadenceMeasurement),cadenceStatusText.textContent="Connected!",cadenceStatusIndicator.className="status-indicator connected",speedStatusIndicator.className="status-indicator connected",speedCadenceConnectButton.disabled=!0}catch(e){cadenceStatusText.textContent=`Error: ${e.message}`,cadenceStatusIndicator.className="status-indicator",speedStatusIndicator.className="status-indicator",console.error("Speed/Cadence connection failed:",e)}});let lastWheelRevs=0,lastWheelTime=0,lastCrankRevs=0,lastCrankTime=0;function handleSpeedCadenceMeasurement(e){let t=e.target.value,a=t.getUint8(0),n=1;if(1&a){let e=t.getUint32(n,!0),a=t.getUint16(n+4,!0);if(n+=6,lastWheelRevs>0){let t=e-lastWheelRevs,n=(a-lastWheelTime)/1024;if(n>0){let e=2.105*t;totalDistance+=e/1e3;let a=e/n*3.6;speedValueElement.textContent=Math.round(a),lastSpeedValue=Math.round(a),distanceValueElement.textContent=totalDistance.toFixed(2)}}lastWheelRevs=e,lastWheelTime=a}if(2&a){let e=t.getUint16(n,!0),a=t.getUint16(n+2,!0);if(lastCrankRevs>0){let t=e-lastCrankRevs,n=(a-lastCrankTime)/1024;if(n>0){let e=t/n*60;cadenceValueElement.textContent=Math.round(e),lastCadenceValue=Math.round(e)}}lastCrankRevs=e,lastCrankTime=a}}function onDisconnectedSpeedCadence(){cadenceStatusText.textContent="Device disconnected.",cadenceStatusIndicator.className="status-indicator",speedStatusIndicator.className="status-indicator",cadenceDeviceName.textContent="",cadenceValueElement.textContent="--",speedValueElement.textContent="--",speedCadenceConnectButton.disabled=!1,speedCadenceBluetoothDevice=null,lastCadenceValue=0,lastSpeedValue=0}
//# sourceMappingURL=power-saver.7e13c160.js.map
