let e,t,n,o,a,r,i,s,c,l,d,u,m,p,g,h,v,w,f,A;class C{constructor(){this.banner=null,this.waitingWorker=null}createBanner(){let e=document.createElement("div");return e.id="pwaUpdateBanner",e.className="pwa-update-banner",e.innerHTML=`
            <div class="pwa-update-content">
                <div class="pwa-update-icon">\u{1F504}</div>
                <div class="pwa-update-text">
                    <strong>Update Available</strong>
                    <span>A new version is ready to install</span>
                </div>
                <div class="pwa-update-actions">
                    <button id="pwaUpdateButton" class="pwa-btn pwa-btn-primary">Update Now</button>
                    <button id="pwaUpdateLater" class="pwa-btn pwa-btn-secondary">Later</button>
                </div>
            </div>
        `,e}show(e){this.waitingWorker=e,this.banner||(this.banner=this.createBanner(),document.body.appendChild(this.banner),this.attachEventListeners()),setTimeout(()=>{this.banner.classList.add("pwa-update-banner-visible")},500)}hide(){this.banner&&(this.banner.classList.remove("pwa-update-banner-visible"),setTimeout(()=>{this.banner&&this.banner.parentNode&&(this.banner.parentNode.removeChild(this.banner),this.banner=null)},300))}attachEventListeners(){let e=this.banner.querySelector("#pwaUpdateButton"),t=this.banner.querySelector("#pwaUpdateLater");e.addEventListener("click",()=>this.handleUpdateClick()),t.addEventListener("click",()=>this.handleLaterClick())}handleUpdateClick(){if(!this.waitingWorker)return void console.log("[PWA] No waiting worker to activate");this.waitingWorker.postMessage({type:"SKIP_WAITING"}),this.showUpdatingMessage(),setTimeout(()=>{window.location.reload()},1e3)}handleLaterClick(){this.hide()}showUpdatingMessage(){this.hide();let e=document.createElement("div");e.className="pwa-toast pwa-toast-info",e.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">\u{1F504}</span>
                <span>Updating app...</span>
            </div>
        `,document.body.appendChild(e),setTimeout(()=>e.classList.add("pwa-toast-visible"),100)}}let E=null,y=null,b=null;var I={};I=import.meta.resolve("7qU26");const S="powerMeterSession";function x(e){try{let t={timestamp:Date.now(),powerData:e.powerData,lastPowerValue:e.lastPowerValue,lastHeartRateValue:e.lastHeartRateValue,lastCadenceValue:e.lastCadenceValue,sessionStartTime:e.sessionStartTime};localStorage.setItem(S,JSON.stringify(t))}catch(e){console.warn("Failed to save session data:",e)}}function k(){localStorage.removeItem(S)}const D={"10s":1e4,"20s":2e4,"30s":3e4,"40s":4e4,"50s":5e4,"1m":6e4,"2m":12e4,"3m":18e4,"4m":24e4,"5m":3e5};let B=Date.now(),L={"10s":{current:0,best:0},"20s":{current:0,best:0},"30s":{current:0,best:0},"40s":{current:0,best:0},"50s":{current:0,best:0},"1m":{current:0,best:0},"2m":{current:0,best:0},"3m":{current:0,best:0},"4m":{current:0,best:0},"5m":{current:0,best:0}};function T(){if(e)try{e.textContent=L["10s"].current||"--",t.textContent=L["10s"].best||"--",n.textContent=L["20s"].current||"--",o.textContent=L["20s"].best||"--",a.textContent=L["30s"].current||"--",r.textContent=L["30s"].best||"--",i.textContent=L["40s"].current||"--",s.textContent=L["40s"].best||"--",c.textContent=L["50s"].current||"--",l.textContent=L["50s"].best||"--",d.textContent=L["1m"].current||"--",u.textContent=L["1m"].best||"--",m.textContent=L["2m"].current||"--",p.textContent=L["2m"].best||"--",g.textContent=L["3m"].current||"--",h.textContent=L["3m"].best||"--",v.textContent=L["4m"].current||"--",w.textContent=L["4m"].best||"--",f.textContent=L["5m"].current||"--",A.textContent=L["5m"].best||"--"}catch(e){console.error("Error updating power averages display:",e.message)}}function M(){for(let e of Object.keys(L))L[e].current=0,L[e].best=0;T()}const R={powerValueElement:null,hrValueElement:null,cadenceValueElement:null,deviceNameElement:null,cadenceDeviceName:null,statusText:null,hrStatusText:null,cadenceStatusText:null,hrConnectionStatus:null,cadenceConnectionStatus:null,powerMeterConnectButton:null,hrConnectButton:null,speedCadenceConnectButton:null,powerAveragesSection:null,hamburgerBtn:null,menuDropdown:null,showInfoMenuItem:null,toggleLogMenuItem:null};function U(){R.powerValueElement&&(R.powerValueElement.textContent="--"),R.hrValueElement&&(R.hrValueElement.textContent="--"),R.cadenceValueElement&&(R.cadenceValueElement.textContent="--")}function N(){let e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}async function Q(){if(!("wakeLock"in navigator))return console.warn("Wake Lock API is not supported in this browser"),!1;try{return(await navigator.wakeLock.request("screen")).addEventListener("release",()=>{console.log("Screen wake lock was released")}),console.log("Screen wake lock acquired"),!0}catch(e){return console.error("Failed to acquire wake lock:",e.name,e.message),!1}}let P=null,Y=null;function H(e,t="info"){if(!P)return void console.warn("Log container not initialized");let n=P.querySelector(".log-empty-message");n&&n.remove();let o=document.createElement("div");o.className=`log-entry log-${t}`;let a=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});o.innerHTML=`
        <span class="log-timestamp">${a}</span>
        <span class="log-message">${function(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}(e)}</span>
    `,P.insertBefore(o,P.firstChild);let r=P.querySelectorAll(".log-entry");r.length>100&&r[r.length-1].remove()}function V(){P&&(P.innerHTML='<div class="log-empty-message">No connection activity yet</div>')}let W=null,F=null,O=null,J=null;async function q(e,t){if(await Q(),console.log("[HR] Connect heart rate monitor requested"),H("Heart rate connection requested","info"),!navigator.bluetooth){let t="Web Bluetooth API is not available.";return console.error("[HR]",t),e.onStatusUpdate(t),H(t,"error"),!1}try{if(e.onStatusUpdate("Scanning for devices..."),H("Scanning for heart rate devices...","info"),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Scanning..."),W){if(e.onStatusUpdate("Cleaning up previous connection..."),H("Cleaning up previous connection","warning"),O&&J){try{O.removeEventListener("characteristicvaluechanged",J)}catch(e){console.warn("[HR] Error removing HR characteristic listener:",e)}J=null,O=null}F&&(W.removeEventListener("gattserverdisconnected",F),F=null),W.gatt.connected&&W.gatt.disconnect(),W=null}if(e.onStatusUpdate("Opening device picker..."),!(W=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["device_information","battery_service"]})))throw Error("No device selected");let n=W.name||"Unknown";return e.onStatusUpdate(`Device selected: ${n}`),console.log("[HR] Device selected:",n),H(`Device selected: ${n}`,"success"),await z(W,e,t),!0}catch(n){if("NotFoundError"===n.name){let n="No device selected.";console.log("[HR]",n),e.onStatusUpdate(n),H(n,"info"),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Disconnected")}else if("NetworkError"===n.name){let o="Connection failed. Check Bluetooth is enabled and device is nearby.";console.error("[HR] Network error (mobile Bluetooth issue):",n),e.onStatusUpdate(o),H(o,"error"),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Connection Failed")}else if("NotSupportedError"===n.name){let o="Heart rate monitor not supported on this device.";console.error("[HR] Not supported error:",n),e.onStatusUpdate(o),H(o,"error"),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Not Supported")}else if("SecurityError"===n.name){let o="Connection blocked. Ensure HTTPS and try again.";console.error("[HR] Security error (HTTPS or user gesture required):",n),e.onStatusUpdate(o),H(o,"error"),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Security Error")}else{let o=`Error: ${n.message}`;console.error("[HR] Connection failed:",n),e.onStatusUpdate(o),H(`Connection failed: ${n.message}`,"error"),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Connection Failed")}if(O&&J){try{O.removeEventListener("characteristicvaluechanged",J)}catch{}J=null,O=null}return W&&F&&(W.removeEventListener("gattserverdisconnected",F),F=null),W=null,!1}}async function z(e,t,n){let o=e.name||"Unknown Device";t.onStatusUpdate(`Connecting to ${o}...`),console.log("[HR] Starting connection to:",o),F=async()=>{await new Promise(e=>setTimeout(e,100)),function(e,t){if(console.log("[HR] Device disconnected event triggered"),H("Heart rate device disconnected","warning"),e.onStatusUpdate("Heart rate monitor disconnected."),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Disconnected"),O&&J){try{O.removeEventListener("characteristicvaluechanged",J)}catch(e){console.warn("[HR] Error removing HR characteristic listener on disconnect:",e)}J=null,O=null}if(W&&F){try{W.removeEventListener("gattserverdisconnected",F)}catch(e){console.warn("[HR] Error removing disconnect listener:",e)}F=null}W=null,e.onHeartRateChange(0),e.onDisconnected&&e.onDisconnected()}(t,n)},e.addEventListener("gattserverdisconnected",F);try{e.gatt.connected&&(t.onStatusUpdate("Resetting existing connection..."),e.gatt.disconnect(),await new Promise(e=>setTimeout(e,200))),t.onStatusUpdate("Establishing GATT connection..."),H("Establishing GATT connection...","info");let a=await e.gatt.connect();if(!a||!e.gatt.connected)throw Error("GATT server connection failed - device not connected");t.onStatusUpdate("Getting heart rate service..."),H("Getting heart rate service","info");let r=await a.getPrimaryService("heart_rate");if(t.onStatusUpdate("Configuring notifications..."),H("Configuring heart rate notifications","info"),O=await r.getCharacteristic("heart_rate_measurement"),J)try{O.removeEventListener("characteristicvaluechanged",J)}catch(e){console.warn("[HR] Error removing old characteristic listener:",e)}t.onStatusUpdate("Starting heart rate notifications..."),await O.startNotifications(),O&&O.value||t.onStatusUpdate("Waiting for heart rate data..."),J=e=>{!function(e,t){try{let n=e.target.value,o=function(e){if(!e||!(e instanceof DataView))throw Error("Invalid heart rate data: value must be a DataView");if(e.byteLength<2)throw Error(`Invalid heart rate data: insufficient data (${e.byteLength} bytes)`);let t=(1&e.getUint8(0))!=0;if(t&&e.byteLength<3)throw Error(`Invalid heart rate data: insufficient data for UINT16 format (${e.byteLength} bytes)`);let n=t?e.getUint16(1,!0):e.getUint8(1);if("number"!=typeof n||n<0||n>300)throw Error(`Invalid heart rate value: ${n}`);return n}(n);if(isNaN(o)||o<0)return void console.error("Invalid heart rate value:",o);t.onHeartRateChange(o)}catch(e){console.error("Error parsing heart rate data:",e.message)}}(e,t)},O.addEventListener("characteristicvaluechanged",J),console.log("[HR] Connection complete!"),t.onStatusUpdate(`Connected to ${o}!`),H(`Successfully connected to ${o}`,"success"),n.hrConnectionStatus&&(n.hrConnectionStatus.textContent="Connected")}catch(n){if(console.error("[HR] Connection error:",n),n.message&&n.message.includes("GATT")){let e="GATT connection failed (check device is on and nearby)";t.onStatusUpdate(e),H(e,"error"),console.error("[HR] GATT connection issue - common on mobile devices")}else t.onStatusUpdate(`Connection failed: ${n.message}`),H(`Connection failed: ${n.message}`,"error");if(O&&J){try{O.removeEventListener("characteristicvaluechanged",J)}catch{}J=null,O=null}throw e.removeEventListener("gattserverdisconnected",F),F=null,n}}function j(){return W&&W.gatt&&!0===W.gatt.connected}let G=null,Z=null,K=null,X=null,$=0,_=0,ee=null;async function et(e,t,n){if(await Q(),!navigator.bluetooth)return t.onStatusUpdate("Web Bluetooth API is not available."),!1;try{if(t.onStatusUpdate(e.scanningMessage),e.elements.statusElement&&n[e.elements.statusElement]&&(n[e.elements.statusElement].textContent="Connecting..."),e.preConnect&&e.preConnect(),e.deviceRef.device&&(e.deviceRef.handler&&(e.deviceRef.device.removeEventListener("gattserverdisconnected",e.deviceRef.handler),e.deviceRef.handler=null),e.deviceRef.device.gatt.connected&&e.deviceRef.device.gatt.disconnect(),e.deviceRef.device=null),e.deviceRef.device=await navigator.bluetooth.requestDevice({filters:[{services:[e.serviceUuid]}]}),!e.deviceRef.device)throw Error("No device selected");t.onStatusUpdate("Connecting to device..."),e.elements.nameElement&&n[e.elements.nameElement]&&(n[e.elements.nameElement].textContent=`Device: ${e.deviceRef.device.name||"Unknown Device"}`),e.deviceRef.handler=()=>{e.onDisconnected(t,n)},e.deviceRef.device.addEventListener("gattserverdisconnected",e.deviceRef.handler);let o=await e.deviceRef.device.gatt.connect(),a=await o.getPrimaryService(e.serviceUuid),r=await a.getCharacteristic(e.characteristicUuid);return await r.startNotifications(),r.addEventListener("characteristicvaluechanged",n=>{e.onCharacteristicChange(n,t)}),t.onStatusUpdate(e.connectedMessage),e.elements.statusElement&&n[e.elements.statusElement]&&(n[e.elements.statusElement].textContent="Connected"),!0}catch(o){return"NotFoundError"===o.name?t.onStatusUpdate("No device selected."):(t.onStatusUpdate(`Error: ${o.message}`),console.error(`${e.errorPrefix} connection failed:`,o)),e.elements.statusElement&&n[e.elements.statusElement]&&(n[e.elements.statusElement].textContent="Connection Failed"),e.deviceRef.device&&(e.deviceRef.handler&&(e.deviceRef.device.removeEventListener("gattserverdisconnected",e.deviceRef.handler),e.deviceRef.handler=null),e.deviceRef.device=null),!1}}async function en(e,t){let n={serviceUuid:"cycling_power",characteristicUuid:"cycling_power_measurement",scanningMessage:"Scanning for power meters...",connectedMessage:"Connected and receiving data!",errorPrefix:"Power meter",deviceRef:{device:G,handler:K},onDisconnected:ec,onCharacteristicChange:ei,elements:{nameElement:"deviceNameElement",statusElement:null}},o=await et(n,e,t);return G=n.deviceRef.device,K=n.deviceRef.handler,o}async function eo(e,t){let n={serviceUuid:"cycling_speed_and_cadence",characteristicUuid:"csc_measurement",scanningMessage:"Scanning for sensors...",connectedMessage:"Connected!",errorPrefix:"Speed/Cadence",deviceRef:{device:Z,handler:X},onDisconnected:el,onCharacteristicChange:es,preConnect:()=>{ee&&(clearTimeout(ee),ee=null),$=0,_=0},elements:{nameElement:"cadenceDeviceName",statusElement:"cadenceConnectionStatus"}},o=await et(n,e,t);return Z=n.deviceRef.device,X=n.deviceRef.handler,o}function ea(){return G&&G.gatt.connected}function er(){return Z&&Z.gatt.connected}function ei(e,t){try{let n=e.target.value;if(!n||!(n instanceof DataView))return void console.error("Invalid power measurement data: value must be a DataView");if(n.byteLength<4)return void console.error(`Invalid power measurement data: insufficient data (${n.byteLength} bytes)`);let o=n.getInt16(2,!0);if(isNaN(o))return void console.error("Invalid power value: NaN");o>3e3?console.warn(`Unusually high power detected: ${o}W`):o<-500&&console.warn(`Unusually low power detected: ${o}W`),t.onPowerMeasurement(o)}catch(e){console.error("Error parsing power measurement data:",e.message)}}function es(e,t){let n=e.target.value,o=n.getUint8(0),a=1;if(1&o&&(a+=6),2&o){let e=n.getUint16(a,!0),o=n.getUint16(a+2,!0);if($>0){let n=e-$,a=(o-_)/1024;if(a>0){let e=Math.round(n/a*60);t.onCadenceChange(e),ee&&clearTimeout(ee),ee=setTimeout(()=>{t.onCadenceChange(0),ee=null},3e3)}}$=e,_=o}}function ec(e,t){e.onStatusUpdate("Power meter disconnected."),t.deviceNameElement&&(t.deviceNameElement.textContent=""),G&&K&&(G.removeEventListener("gattserverdisconnected",K),K=null),G=null,e.onDisconnected()}function el(e,t){e.onStatusUpdate("Device disconnected."),t.cadenceConnectionStatus&&(t.cadenceConnectionStatus.textContent="Disconnected"),t.cadenceDeviceName&&(t.cadenceDeviceName.textContent=""),Z=null,e.onCadenceChange(0),e.onDisconnected&&e.onDisconnected(),ee&&(clearTimeout(ee),ee=null),$=0,_=0}function ed(e){return void 0!==e.power&&e.power>0}function eu(e){let t={time:e=>`<Time>${new Date(e).toISOString()}</Time>`,heartRate:e=>`<HeartRateBpm>
      <Value>${Math.round(e)}</Value>
    </HeartRateBpm>`,cadence:e=>`<Cadence>${Math.round(e)}</Cadence>`,power:e=>{let t=Math.max(0,Math.min(2e3,Math.round(e)));return`<Extensions>
      <TPX xmlns="http://www.garmin.com/xmlschemas/ActivityExtension/v2">
        <Watts>${t}</Watts>
      </TPX>
    </Extensions>`}},n=Object.keys(t).map(n=>void 0===e[n]?"":t[n](e[n])).filter(Boolean).join("\n");return`<Trackpoint>
${n}
</Trackpoint>`}function em(e){return{time:e.timestamp,...void 0!==e.power&&{power:e.power},...void 0!==e.heartRate&&{heartRate:e.heartRate},...void 0!==e.cadence&&{cadence:e.cadence}}}function ep(e){if(!Array.isArray(e)||0===e.length)return"";let t=e.filter(e=>{var t;return e&&"object"==typeof e&&void 0!==(t=e.timestamp)&&!isNaN(new Date(t).getTime())});if(0===t.length)return"";let n=function(e){let t=[...e];for(;t.length>0&&!ed(t[0]);)t.shift();for(;t.length>0&&!ed(t[t.length-1]);)t.pop();return t}(t.map(em).sort((e,t)=>e.time-t.time));if(0===n.length)return"";let o=n.map(eu).join("\n"),a=new Date(n[0].time).toISOString(),r=function(e){if(0===e.length)return 0;let t=e[0].time;return Math.round((e[e.length-1].time-t)/1e3)}(n);return`<?xml version="1.0" encoding="UTF-8"?>
<TrainingCenterDatabase
  xmlns="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2
    http://www.garmin.com/xmlschemas/TrainingCenterDatabasev2.xsd">
  <Activities>
    <Activity Sport="Biking">
      <Id>${a}</Id>
      <Lap StartTime="${a}">
        <TotalTimeSeconds>${r}</TotalTimeSeconds>
        <DistanceMeters>0</DistanceMeters>
        <Calories>0</Calories>
        <Intensity>Active</Intensity>
        <TriggerMethod>Manual</TriggerMethod>
        <Track>
${o}
        </Track>
      </Lap>
    </Activity>
  </Activities>
</TrainingCenterDatabase>`}const eg="application/vnd.garmin.tcx+xml;charset=utf-8;";function eh(e){if(!e)throw Error("Power data is null or undefined");if(!Array.isArray(e))throw Error("Power data must be an array");if(0===e.length)throw Error("Power data array is empty");let t=e.filter(e=>!e||"object"!=typeof e||void 0===e.timestamp);if(t.length>0)throw Error(`Power data contains ${t.length} invalid item(s)`);return!0}function ev(e){eh(e),eA(new Blob([JSON.stringify({mainSensors:e},null,2)],{type:"application/json;charset=utf-8;"}),`power_data_${N()}.json`)}function ew(e){eh(e);let t="timestamp,power,heartRate,cadence\n";e.forEach(e=>{let n=e.timestamp??"",o=e.power??"",a=e.heartRate??"",r=e.cadence??"";t+=`${n},${o},${a},${r}
`}),eA(new Blob([t],{type:"text/csv;charset=utf-8;"}),`power_data_${N()}.csv`)}function ef(e){eh(e);try{let t=ep(e);if(!t)throw Error("Failed to generate TCX content");let n=new Blob([t],{type:eg});eA(n,`power_data_${N()}.tcx`)}catch(e){throw console.error("Error generating TCX:",e),e}}function eA(e,t){try{if(!e||!(e instanceof Blob))throw Error("Invalid blob provided for download");if(!t||"string"!=typeof t)throw Error("Invalid filename provided for download");let n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}catch(e){throw console.error("Error during file download:",e),e}}async function eC(e,t){if(eh(e),!t||"string"!=typeof t||""===t.trim())throw Error("API key is required");try{let n=ep(e);if(!n)throw Error("Failed to generate TCX content for upload");let o=t.trim(),a=o.includes(":"),r=new Blob([n],{type:eg}),i=new File([r],`workout_${N()}.tcx`,{type:eg}),s=new FormData;s.append("file",i);let c={Authorization:`Basic ${btoa(o)}`},l=await fetch("https://intervals.icu/api/v1/athlete/i"+(a?"":"0")+"/activities",{method:"POST",headers:c,body:s});if(!l.ok){let e=await l.text();throw Error(`Upload failed: ${l.status} ${l.statusText}. ${e}`)}let d=await l.json();return console.log("✅ Successfully uploaded to intervals.icu:",d),d}catch(e){throw console.error("Error uploading to intervals.icu:",e),e}}async function eE(e){let{powerData:t}=e;eh(t);let n=[];for(let{name:e,fn:o}of[{name:"Summary JSON",fn:()=>ev(t)},{name:"Summary CSV",fn:()=>ew(t)},{name:"TCX",fn:()=>ef(t)}]){try{o(),console.log(`\u{2713} ${e} exported`)}catch(t){n.push(`${e}: ${t.message}`)}await new Promise(e=>setTimeout(e,100))}if(n.length>0){let e=`Some exports failed:
${n.join("\n")}`;throw console.warn("Export errors:",n),Error(e)}console.log("✅ All exports completed successfully!")}function ey(e,t){let n=`Error during ${t} export: ${e.message}`;console.error(n,e),alert(n)}async function eb(){try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>(console.log("Deleting cache:",e),caches.delete(e)))),console.log("All caches cleared")}if(navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),navigator.serviceWorker)for(let e of(await navigator.serviceWorker.getRegistrations()))await e.unregister(),console.log("Service worker unregistered")}catch(e){console.error("Error clearing cache:",e)}}function eI(e,t){let n=document.createElement("div");return n.className="export-modal",n.innerHTML=`
        <div class="export-modal-content">
            <div class="export-modal-header">
                <h3 class="export-modal-title">${e}</h3>
                <button class="export-modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="export-modal-description">${t}</div>
            <div class="export-modal-buttons"></div>
        </div>
    `,n.querySelector(".export-modal-close").addEventListener("click",()=>ek(n)),n.addEventListener("click",e=>{e.target===n&&ek(n)}),n}function eS(e,t){let n=e.querySelector(".export-modal-buttons");t.forEach(e=>{let t=document.createElement("button");if(t.className=`export-modal-button ${e.className||""}`,t.disabled=e.disabled||!1,t.innerHTML=`
            <span>${e.text}</span>
            ${e.description?`<small style="opacity: 0.7; font-size: 0.8em;">${e.description}</small>`:""}
        `,t.addEventListener("click",e.onClick),n.appendChild(t),e.className&&e.className.includes("export-all")){let e=document.createElement("div");e.className="export-modal-separator",e.innerHTML="<span>Individual Exports</span>",n.appendChild(e)}})}function ex(e){document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("show")})}function ek(e){e.classList.remove("show"),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},300)}function eD(e,t){let n=document.createElement("div");n.className="metric-info-modal",n.innerHTML=`
        <div class="metric-info-content">
            <div class="metric-info-header">
                <h3>${e}</h3>
                <button class="metric-info-close" aria-label="Close">\xd7</button>
            </div>
            <div class="metric-info-body">
                <p>${t}</p>
            </div>
        </div>
    `,document.body.appendChild(n),setTimeout(()=>n.classList.add("active"),10);let o=n.querySelector(".metric-info-close"),a=()=>{n.classList.remove("active"),setTimeout(()=>n.remove(),300)};o.addEventListener("click",a),n.addEventListener("click",e=>{e.target===n&&a()});let r=e=>{"Escape"===e.key&&(a(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r)}let eB=[],eL=0,eT=0,eM=0,eR=null,eU=null,eN=null,eQ=!1;const eP={get powerData(){return eB},get lastPowerValue(){return eL},get lastHeartRateValue(){return eT},get lastCadenceValue(){return eM},get sessionStartTime(){return eR},resetAllSessionData:function(){eB.length=0,M(),eL=0,eT=0,eM=0,eR=null,eQ=!1,U(),k()},elements:R},eY={onPowerMeasurement:e=>{!function(e){if(!R.powerValueElement)return;let t=e||"--";R.powerValueElement.textContent=t,R.powerValueElement.setAttribute("data-value",t)}(e),eL=e,function(e){if("number"!=typeof e||isNaN(e)||e>3e3||e<0)return;let t=Date.now(),n=t-B;for(let[o,a]of(B=t,Object.entries(D))){let t=Math.round(((L[o].current||0)*(a-n)+e*n)/a);L[o].current=t,t>L[o].best&&(L[o].best=t)}}(e)},onDisconnected:()=>{U(),0===eB.length&&M(),eU&&(clearInterval(eU),eU=null),eL=0,eW()},onStatusUpdate:e=>{R.statusText&&(R.statusText.textContent=e)}},eH={onHeartRateChange:e=>{R.hrValueElement&&(R.hrValueElement.textContent=e),eT=e},onStatusUpdate:e=>{R.hrStatusText&&(R.hrStatusText.textContent=e)},onDisconnected:()=>{eW()}},eV={onCadenceChange:e=>{R.cadenceValueElement&&(R.cadenceValueElement.textContent=e),eM=e},onStatusUpdate:e=>{R.cadenceStatusText&&(R.cadenceStatusText.textContent=e)},onDisconnected:()=>{eW()}};function eW(){var e;e={powerMeter:ea(),heartRate:j(),speedCadence:er()},R.powerMeterConnectButton&&R.powerMeterConnectButton.setAttribute("data-connected",e.powerMeter?"true":"false"),R.hrConnectButton&&R.hrConnectButton.setAttribute("data-connected",e.heartRate?"true":"false"),R.speedCadenceConnectButton&&R.speedCadenceConnectButton.setAttribute("data-connected",e.speedCadence?"true":"false"),R.powerAveragesSection&&R.powerAveragesSection.setAttribute("data-connected",e.powerMeter?"true":"false")}async function eF(){try{R.powerValueElement=document.getElementById("power-value"),R.hrValueElement=document.getElementById("hr-value"),R.cadenceValueElement=document.getElementById("cadence-value"),R.deviceNameElement=document.getElementById("device-name"),R.cadenceDeviceName=document.getElementById("cadenceDeviceName"),R.statusText=document.getElementById("status"),R.hrStatusText=document.getElementById("hrStatus"),R.cadenceStatusText=document.getElementById("cadenceStatus"),R.hrConnectionStatus=document.getElementById("hrConnectionStatus"),R.cadenceConnectionStatus=document.getElementById("cadenceConnectionStatus"),R.powerMeterConnectButton=document.getElementById("connectButton"),R.hrConnectButton=document.getElementById("hrConnectButton"),R.speedCadenceConnectButton=document.getElementById("speedCadenceConnectButton"),R.powerAveragesSection=document.getElementById("powerAveragesSection"),R.hamburgerBtn=document.getElementById("hamburgerButton"),R.menuDropdown=document.getElementById("menuDropdown"),R.showInfoMenuItem=document.getElementById("showInfoMenuItem"),R.toggleLogMenuItem=document.getElementById("toggleLogMenuItem"),R.hrConnectionStatus&&(R.hrConnectionStatus.textContent="Disconnected"),R.cadenceConnectionStatus&&(R.cadenceConnectionStatus.textContent="Disconnected"),e=document.getElementById("avg10s-current"),t=document.getElementById("avg10s-best"),n=document.getElementById("avg20s-current"),o=document.getElementById("avg20s-best"),a=document.getElementById("avg30s-current"),r=document.getElementById("avg30s-best"),i=document.getElementById("avg40s-current"),s=document.getElementById("avg40s-best"),c=document.getElementById("avg50s-current"),l=document.getElementById("avg50s-best"),d=document.getElementById("avg1m-current"),u=document.getElementById("avg1m-best"),m=document.getElementById("avg2m-current"),p=document.getElementById("avg2m-best"),g=document.getElementById("avg3m-current"),h=document.getElementById("avg3m-best"),v=document.getElementById("avg4m-current"),w=document.getElementById("avg4m-best"),f=document.getElementById("avg5m-current"),A=document.getElementById("avg5m-best"),R.powerAveragesSection&&(R.powerAveragesSection.style.display="block");let C=document.querySelector(".dashboard"),E=document.getElementById("powerAveragesSection"),y=E&&"none"===E.style.display;C&&(y?C.classList.add("maximized"):C.classList.remove("maximized")),function(){let e=document.querySelector(".dashboard");if(!e)return;let t=document.querySelector(".collapsed-sections-row");t&&(t.querySelectorAll(".power-averages-section").forEach(t=>{e.parentNode.insertBefore(t,e.nextSibling)}),t.remove()),e.classList.remove("has-collapsed-sections")}();let b=document.getElementById("powerIcon");b&&b.addEventListener("click",e=>{e.preventDefault(),eD("⚡ Power Output","Power output is measured in Watts and represents the amount of work you are doing on the bike. It is calculated by measuring the force applied to the pedals and the speed of pedaling. Higher power output means you are working harder. This metric is the most accurate way to measure cycling effort.")});let I=document.getElementById("hrIcon");I&&I.addEventListener("click",e=>{e.preventDefault(),eD("❤️ Heart Rate","Heart rate is measured in beats per minute (BPM) and indicates how hard your cardiovascular system is working. Your heart rate increases as exercise intensity increases. Monitoring heart rate helps you train in specific zones for different fitness goals. Connect a Bluetooth heart rate monitor to track this metric.")});let D=document.getElementById("cadenceIcon");D&&D.addEventListener("click",e=>{e.preventDefault(),eD("\uD83D\uDEB4 Cadence","Cadence is measured in revolutions per minute (RPM) and represents how fast you are pedaling. Most cyclists aim for a cadence between 80-100 RPM for optimal efficiency. Higher cadence with lower resistance can reduce muscle fatigue, while lower cadence with higher resistance builds strength. Connect a speed & cadence sensor to track this metric.")}),P=document.getElementById("connectionLogContent"),Y=document.getElementById("connectionLogSection");let B=document.getElementById("clearLogButton");B&&B.addEventListener("click",V),function(e){if(!e.hamburgerBtn||!e.menuDropdown)return console.error("Hamburger menu elements not found:",{hamburgerBtn:!!e.hamburgerBtn,menuDropdown:!!e.menuDropdown});e.hamburgerBtn.addEventListener("click",function(){e.menuDropdown.classList.contains("active")?e.menuDropdown.classList.remove("active"):e.menuDropdown.classList.add("active")}),document.addEventListener("click",function(t){t.target.closest(".hamburger-menu")||e.menuDropdown.classList.remove("active")})}(R),R.showInfoMenuItem?R.showInfoMenuItem.addEventListener("click",function(){!function(){let e=document.createElement("div");e.className="modal-backdrop",e.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    `;let t=document.createElement("div");t.className="modal",t.style.cssText=`
        background: #1a1a2e;
        border-radius: 12px;
        padding: 2rem;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        margin: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    `;let n=document.createElement("canvas");n.width=200,n.height=200,n.style.cssText=`
        background: white;
        border-radius: 8px;
        margin: 1rem auto;
        max-width: 100%;
        height: auto;
        display: block;
    `,t.innerHTML=`
        <div style="text-align: center; margin-bottom: 1.5rem;">
            <h2 style="color: #3498db; margin: 0 0 0.5rem 0; font-size: 1.8rem;">\u{1F6B4} Web Bluetooth Power Meter</h2>
            <p style="color: #cccccc; margin: 0; font-size: 1rem;">Real-time cycling data analysis</p>
        </div>

        <div style="color: #ffffff; line-height: 1.6;">
            <h3 style="color: #f39c12; margin: 1.5rem 0 1rem 0;">\u{1F4F1} Share This App</h3>
            <div style="text-align: center; margin-bottom: 1rem;">
                <div id="qr-container" style="margin: 1rem 0;"></div>
                <p style="color: #ffffff; margin: 0.5rem 0; font-weight: 600;">Scan to access on any device</p>
                <a href="https://colscoding.github.io/power-saver/" target="_blank" style="
                    color: #9b59b6; 
                    text-decoration: none; 
                    font-size: 0.9rem;
                    word-break: break-all;
                    line-height: 1.4;
                ">https://colscoding.github.io/power-saver/</a>
            </div>

            <h3 style="color: #f39c12; margin: 1.5rem 0 1rem 0;">\u{1F4F1} What is this app?</h3>
            <p style="margin-bottom: 1rem;">
                This is a web-based power meter application that connects to Bluetooth devices:
            </p>
            <ul style="margin: 0 0 1rem 1rem; padding-left: 1rem;">
                <li>cycling power meter</li>
                <li>cadence sensor</li>
                <li>heart rate sensor</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <button id="closeInfoModal" style="
                background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            ">Got it!</button>
        </div>
    `,t.querySelector("#qr-container").appendChild(n),function(e){let t=e.getContext("2d"),n=e.width;t.fillStyle="#ffffff",t.fillRect(0,0,n,n);let o=new Image;o.onload=function(){t.drawImage(o,0,0,n,n)},o.onerror=function(){var e=t,o=n;e.fillStyle="#000000",e.font="12px Arial",e.textAlign="center";let a=o/25;for(let t=0;t<25;t++)for(let n=0;n<25;n++)((t+n)%3==0||0===t||24===t||0===n||24===n)&&e.fillRect(t*a,n*a,a,a);e.fillStyle="#ffffff",e.fillRect(.2*o,.4*o,.6*o,.2*o),e.fillStyle="#000000",e.fillText("QR Code",o/2,o/2-10),e.fillText("Unavailable",o/2,o/2+10)},o.src="data:image/png;base64,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"}(n),e.appendChild(t),document.body.appendChild(e);let o=t.querySelector("#closeInfoModal"),a=()=>{document.body.removeChild(e)};o.addEventListener("click",a),e.addEventListener("click",t=>{t.target===e&&a()});let r=e=>{"Escape"===e.key&&(a(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),o.addEventListener("mouseenter",()=>{o.style.transform="translateY(-2px)",o.style.boxShadow="0 8px 24px rgba(52, 152, 219, 0.4)"}),o.addEventListener("mouseleave",()=>{o.style.transform="translateY(0)",o.style.boxShadow="none"})}(),R.menuDropdown&&R.menuDropdown.classList.remove("active")}):console.error("Show info menu item not found"),R.toggleLogMenuItem?R.toggleLogMenuItem.addEventListener("click",function(){!function(){if(!Y)return;let e="none"===Y.style.display;Y.style.display=e?"block":"none"}(),R.menuDropdown&&R.menuDropdown.classList.remove("active")}):console.error("Toggle log menu item not found"),R.powerMeterConnectButton&&R.powerMeterConnectButton.addEventListener("click",async()=>{if(ea()){confirm("Disconnect power meter?")&&G&&G.gatt.connected&&G.gatt.disconnect();return}eQ||(eB.length=0,eL=0,M()),eU&&clearInterval(eU),await en(eY,R)&&(eR||(eR=Date.now()),eU=setInterval(()=>{eB.push({timestamp:Date.now(),power:eL,heartRate:eT,cadence:eM}),eB.length%100==0&&x(eP)},100),eQ=!1,eW())}),R.hrConnectButton&&R.hrConnectButton.addEventListener("click",async()=>{if(j()){confirm("Disconnect heart rate monitor?")&&function(){if(W){if(O&&J)try{O.removeEventListener("characteristicvaluechanged",J),J=null}catch(e){console.warn("[HR] Error cleaning up characteristic listener:",e)}if(O&&W.gatt&&W.gatt.connected)try{O.stopNotifications().catch(()=>{})}catch(e){console.warn("[HR] Error stopping notifications:",e)}if(O=null,W.gatt&&W.gatt.connected)try{W.gatt.disconnect()}catch(e){console.warn("[HR] Error disconnecting GATT:",e)}}}();return}await q(eH,R)&&eW()}),R.speedCadenceConnectButton&&R.speedCadenceConnectButton.addEventListener("click",async()=>{if(er()){confirm("Disconnect cadence sensor?")&&Z&&Z.gatt.connected&&Z.gatt.disconnect();return}await eo(eV,R)&&eW()});let L=document.getElementById("exportMenuItem");L&&L.addEventListener("click",()=>{let e=eI("\uD83D\uDCC4 Exports","Export your session data in various formats"),t=[{text:"\uD83D\uDCE5 Export All Files",description:"Download all export formats at once",className:"export-all primary",onClick:async()=>{try{await eE({powerData:eP.powerData}),ek(e),alert("All export files downloaded successfully!")}catch(e){ey(e,"all files")}}},{text:"\uD83D\uDCCA Export JSON",description:"JavaScript Object Notation format",onClick:()=>{try{ev(eP.powerData),ek(e)}catch(e){ey(e,"JSON")}}},{text:"\uD83D\uDCCA Export CSV",description:"Comma-Separated Values format",onClick:()=>{try{ew(eP.powerData),ek(e)}catch(e){ey(e,"CSV")}}},{text:"\uD83C\uDFC3 Export TCX",description:"Training Center XML format",onClick:()=>{try{ef(eP.powerData),ek(e)}catch(e){ey(e,"TCX")}}},{text:"☁️ Upload to intervals.icu",description:"Upload workout directly to intervals.icu",onClick:async t=>{let n=prompt("Enter your intervals.icu API key:\n\nFormat: athleteId:apiKey or just apiKey\nFind it at: intervals.icu → Settings → Developer Settings\n\nNote: API key is not stored and only used for this upload.");if(!n)return;let o=t.target.closest("button");if(o)try{o.innerHTML='<span>⏳ Uploading...</span><small style="opacity: 0.7; font-size: 0.8em;">Please wait</small>',o.disabled=!0,await eC(eP.powerData,n),ek(e),alert("✅ Successfully uploaded workout to intervals.icu!")}catch(e){o.innerHTML='<span>☁️ Upload to intervals.icu</span><small style="opacity: 0.7; font-size: 0.8em;">Upload workout directly to intervals.icu</small>',o.disabled=!1,ey(e,"intervals.icu upload")}}}];eS(e,t),ex(e)});let U=document.getElementById("exportUtilsMenuItem");U&&U.addEventListener("click",()=>{let e=eI("\uD83D\uDEE0️ Utilities","Session management and utilities"),t=[{text:"� Clear App Cache",description:"Clear cached files and force reload (ensures fresh version)",className:"primary",onClick:async()=>{confirm("This will clear the app cache and reload to get the latest version. Continue?")&&(await eb(),alert("Cache cleared! The page will now reload."),window.location.reload(!0))}},{text:"�\uD83D\uDDD1️ Clear Session Data",description:"Clear all session data (cannot be undone)",className:"danger",onClick:()=>{confirm("Are you sure you want to clear all session data? This action cannot be undone.")&&(eP.resetAllSessionData(),alert("Session data cleared successfully!"),ek(e))}}];eS(e,t),ex(e)}),eW();let N=function(){try{let e=localStorage.getItem(S);if(!e)return null;let t=JSON.parse(e);if(!(t&&"object"==typeof t&&t.timestamp&&t.powerData&&Array.isArray(t.powerData)&&1))return console.warn("Invalid session data structure, clearing..."),localStorage.removeItem(S),null;if(Date.now()-t.timestamp>864e5)return console.log("Session expired, clearing..."),localStorage.removeItem(S),null;return t}catch(e){return console.warn("Failed to load session data:",e),localStorage.removeItem(S),null}}();N&&await new Promise(e=>{let t=document.createElement("div");t.className="modal-backdrop";let n=document.createElement("div");n.className="modal";let o=Math.round((Date.now()-N.timestamp)/6e4),a=N.powerData?.length||0;n.innerHTML=`
      <h3>Previous Session Found</h3>
      <p>
        A previous session was found from ${o} minutes ago with ${a} data points.
      </p>
      <p>
        Would you like to restore this session or start fresh?
      </p>
      <div class="modal-buttons">
        <button id="startFresh" class="modal-button secondary">Start Fresh</button>
        <button id="restoreSession" class="modal-button primary">Restore Session</button>
      </div>
    `,t.appendChild(n),document.body.appendChild(t),n.querySelector("#startFresh").addEventListener("click",()=>{document.body.removeChild(t),k(),eQ=!1,e(!1)}),n.querySelector("#restoreSession").addEventListener("click",()=>{document.body.removeChild(t),e(!0)}),t.addEventListener("click",n=>{n.target===t&&(document.body.removeChild(t),eQ=!1,e(!1))})})?function(e){try{var t;e.powerData&&(eB.length=0,eB.push(...e.powerData)),void 0!==e.lastPowerValue&&(eL=e.lastPowerValue),void 0!==e.lastHeartRateValue&&(eT=e.lastHeartRateValue),void 0!==e.lastCadenceValue&&(eM=e.lastCadenceValue),void 0!==e.sessionStartTime&&(eR=e.sessionStartTime),eQ=!0,void 0!==(t={power:eL,heartRate:eT,cadence:eM}).power&&R.powerValueElement&&(R.powerValueElement.textContent=t.power||"--"),void 0!==t.heartRate&&R.hrValueElement&&(R.hrValueElement.textContent=t.heartRate||"--"),void 0!==t.cadence&&R.cadenceValueElement&&(R.cadenceValueElement.textContent=t.cadence||"--"),T(),eB.length>0&&function(e){if(!document.getElementById("notification-styles")){let e=document.createElement("style");e.id="notification-styles",e.textContent=`
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `,document.head.appendChild(e)}let t=function(e,t){let n=document.createElement("div");return n.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${t};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        z-index: 1000;
        font-size: 0.9rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease-out;
        max-width: 300px;
        word-wrap: break-word;
    `,n.textContent=e,n}(`Session restored! ${e} data points recovered.`,"#4CAF50");document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideIn 0.3s ease-out reverse",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},5e3)}(eB.length),console.log(`Session restored: ${eB.length} data points from ${new Date(eR).toLocaleString()}`)}catch(e){return console.warn("Failed to restore session data:",e),!1}}(N):eR=Date.now(),window.addEventListener("beforeunload",eO),eN=setInterval(()=>{eB.length>0&&x(eP)},3e4)}catch(e){console.error("Failed to initialize application:",e),alert("Failed to initialize application. Please refresh the page.")}}function eO(){eB.length>0&&x(eP),eU&&(clearInterval(eU),eU=null),eN&&(clearInterval(eN),eN=null)}document.addEventListener("DOMContentLoaded",()=>{let e,t;eF(),e=0,t=!1,document.body.addEventListener("touchstart",n=>{0===window.scrollY&&(e=n.touches[0].pageY,t=!0)},{passive:!0}),document.body.addEventListener("touchmove",n=>{t&&0===window.scrollY&&n.touches[0].pageY-e>10&&n.preventDefault()},{passive:!1}),document.body.addEventListener("touchend",()=>{t=!1}),window.addEventListener("beforeunload",e=>{if(eB.length>0||ea()||j()||er()){let t="You have active data or connections. Are you sure you want to refresh?";return e.preventDefault(),e.returnValue=t,t}}),document.body.style.overscrollBehavior="contain"}),function(){if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.port){console.log("[PWA] Development mode detected - skipping service worker registration"),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>{e.unregister(),console.log("[PWA] Unregistered existing service worker for development")})});return}"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{let e=await navigator.serviceWorker.register(I,{updateViaCache:"none"});console.log("[PWA] Service Worker registered:",e.scope),e.update(),setInterval(()=>{console.log("[PWA] Checking for updates..."),e.update()},3e5),e.addEventListener("updatefound",()=>{let t=e.installing;console.log("[PWA] Update found, installing new service worker..."),t.addEventListener("statechange",()=>{var e;"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("[PWA] New version available"),e=t,console.log("[PWA] Update available. New version can be activated."),y||(y=new C),y.show(e)):console.log("[PWA] Content cached for offline use"))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[PWA] Controller changed, reloading page..."),window.location.reload()})}catch(e){console.error("[PWA] Service Worker registration failed:",e)}}):console.warn("[PWA] Service Workers are not supported in this browser")}(),E||(E=new class e{constructor(){this.banner=null,this.deferredPrompt=null}createBanner(){let e=document.createElement("div");return e.id="pwaInstallBanner",e.className="pwa-install-banner",e.innerHTML=`
            <div class="pwa-install-content">
                <div class="pwa-install-icon">\u{26A1}</div>
                <div class="pwa-install-text">
                    <strong>Install Power Meter</strong>
                    <span>Add to home screen for quick access</span>
                </div>
                <div class="pwa-install-actions">
                    <button id="pwaInstallButton" class="pwa-btn pwa-btn-primary">Install</button>
                    <button id="pwaInstallClose" class="pwa-btn pwa-btn-secondary">\xd7</button>
                </div>
            </div>
        `,e}show(e){this.isInstalled()||this.wasRecentlyDismissed()||(this.deferredPrompt=e,this.banner||(this.banner=this.createBanner(),document.body.appendChild(this.banner),this.attachEventListeners()),setTimeout(()=>{this.banner.classList.add("pwa-install-banner-visible")},500))}hide(){this.banner&&(this.banner.classList.remove("pwa-install-banner-visible"),setTimeout(()=>{this.banner&&this.banner.parentNode&&(this.banner.parentNode.removeChild(this.banner),this.banner=null)},300))}attachEventListeners(){let e=this.banner.querySelector("#pwaInstallButton"),t=this.banner.querySelector("#pwaInstallClose");e.addEventListener("click",()=>this.handleInstallClick()),t.addEventListener("click",()=>this.handleCloseClick())}async handleInstallClick(){if(!this.deferredPrompt)return void console.log("[PWA] Install prompt not available");this.deferredPrompt.prompt();let{outcome:e}=await this.deferredPrompt.userChoice;console.log(`[PWA] Install prompt outcome: ${e}`),this.hide(),this.deferredPrompt=null,"accepted"===e&&this.showThankYouMessage()}handleCloseClick(){this.hide(),localStorage.setItem("pwaInstallDismissed",Date.now().toString())}wasRecentlyDismissed(){let e=localStorage.getItem("pwaInstallDismissed");return!!e&&Date.now()-parseInt(e)<6048e5}isInstalled(){return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone}showThankYouMessage(){let e=document.createElement("div");e.className="pwa-toast pwa-toast-success",e.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">\u{2713}</span>
                <span>Thanks for installing! Launch from your home screen.</span>
            </div>
        `,document.body.appendChild(e),setTimeout(()=>e.classList.add("pwa-toast-visible"),100),setTimeout(()=>{e.classList.remove("pwa-toast-visible"),setTimeout(()=>e.remove(),300)},4e3)}}),window.addEventListener("beforeinstallprompt",e=>{console.log("[PWA] Install prompt available"),e.preventDefault(),E.show(e)}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App successfully installed"),E&&E.hide()}),setTimeout(()=>{!function(){let e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=!0===window.navigator.standalone;if(e&&!t){let e=localStorage.getItem("iosInstallDismissed");if(e&&Date.now()-parseInt(e)<2592e5)return;let t=document.createElement("div");t.className="pwa-ios-instructions",t.innerHTML=`
            <div class="pwa-ios-content">
                <div class="pwa-ios-header">
                    <span class="pwa-ios-icon">\u{1F4F1}</span>
                    <strong>Install Power Meter</strong>
                    <button class="pwa-ios-close" id="pwaIOSClose">\xd7</button>
                </div>
                <div class="pwa-ios-steps">
                    <p>Tap <strong>Share</strong> <span style="font-size: 1.2em;">\u{25A1}\u{2191}</span> then <strong>Add to Home Screen</strong></p>
                </div>
            </div>
        `,document.body.appendChild(t),setTimeout(()=>t.classList.add("pwa-ios-instructions-visible"),500),t.querySelector("#pwaIOSClose").addEventListener("click",()=>{t.classList.remove("pwa-ios-instructions-visible"),setTimeout(()=>t.remove(),300),localStorage.setItem("iosInstallDismissed",Date.now().toString())})}}()},2e3),b||(b=new class e{constructor(){this.indicator=null,this.isOnline=navigator.onLine}createIndicator(){let e=document.createElement("div");return e.id="pwaOfflineIndicator",e.className="pwa-offline-indicator",e.innerHTML=`
            <div class="pwa-offline-content">
                <span class="pwa-offline-icon">\u{1F4F4}</span>
                <span class="pwa-offline-text">You're offline</span>
            </div>
        `,e}init(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),navigator.onLine||this.handleOffline()}handleOnline(){this.isOnline=!0,console.log("[PWA] Connection restored"),this.hide(),this.showToast("✓","Back online","success")}handleOffline(){this.isOnline=!1,console.log("[PWA] Connection lost"),this.show()}show(){this.indicator||(this.indicator=this.createIndicator(),document.body.appendChild(this.indicator)),setTimeout(()=>{this.indicator.classList.add("pwa-offline-indicator-visible")},100)}hide(){this.indicator&&(this.indicator.classList.remove("pwa-offline-indicator-visible"),setTimeout(()=>{this.indicator&&this.indicator.parentNode&&(this.indicator.parentNode.removeChild(this.indicator),this.indicator=null)},300))}showToast(e,t,n="info"){let o=document.createElement("div");o.className=`pwa-toast pwa-toast-${n}`,o.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">${e}</span>
                <span>${t}</span>
            </div>
        `,document.body.appendChild(o),setTimeout(()=>o.classList.add("pwa-toast-visible"),100),setTimeout(()=>{o.classList.remove("pwa-toast-visible"),setTimeout(()=>o.remove(),300)},3e3)}}),b.init(),window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone?console.log("[PWA] Running as installed app"):console.log("[PWA] Running in browser");
//# sourceMappingURL=power-saver.6141bdc6.js.map
