let e,t,n,a,o,r,i,s,c,l,d,u,m,g,p,h,w,v,A,f;class C{constructor(){this.banner=null,this.waitingWorker=null}createBanner(){let e=document.createElement("div");return e.id="pwaUpdateBanner",e.className="pwa-update-banner",e.innerHTML=`
            <div class="pwa-update-content">
                <div class="pwa-update-icon">\u{1F504}</div>
                <div class="pwa-update-text">
                    <strong>Update Available</strong>
                    <span>A new version is ready to install</span>
                </div>
                <div class="pwa-update-actions">
                    <button id="pwaUpdateButton" class="pwa-btn pwa-btn-primary">Update Now</button>
                    <button id="pwaUpdateLater" class="pwa-btn pwa-btn-secondary">Later</button>
                </div>
            </div>
        `,e}show(e){this.waitingWorker=e,this.banner||(this.banner=this.createBanner(),document.body.appendChild(this.banner),this.attachEventListeners()),setTimeout(()=>{this.banner.classList.add("pwa-update-banner-visible")},500)}hide(){this.banner&&(this.banner.classList.remove("pwa-update-banner-visible"),setTimeout(()=>{this.banner&&this.banner.parentNode&&(this.banner.parentNode.removeChild(this.banner),this.banner=null)},300))}attachEventListeners(){let e=this.banner.querySelector("#pwaUpdateButton"),t=this.banner.querySelector("#pwaUpdateLater");e.addEventListener("click",()=>this.handleUpdateClick()),t.addEventListener("click",()=>this.handleLaterClick())}handleUpdateClick(){if(!this.waitingWorker)return void console.log("[PWA] No waiting worker to activate");this.waitingWorker.postMessage({type:"SKIP_WAITING"}),this.showUpdatingMessage(),setTimeout(()=>{window.location.reload()},1e3)}handleLaterClick(){this.hide()}showUpdatingMessage(){this.hide();let e=document.createElement("div");e.className="pwa-toast pwa-toast-info",e.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">\u{1F504}</span>
                <span>Updating app...</span>
            </div>
        `,document.body.appendChild(e),setTimeout(()=>e.classList.add("pwa-toast-visible"),100)}}let y=null,E=null,b=null;var I={};I=import.meta.resolve("7qU26");const S="powerMeterSession";function x(e){try{let t={timestamp:Date.now(),powerData:e.powerData,lastPowerValue:e.lastPowerValue,lastHeartRateValue:e.lastHeartRateValue,lastCadenceValue:e.lastCadenceValue,sessionStartTime:e.sessionStartTime};localStorage.setItem(S,JSON.stringify(t))}catch(e){console.warn("Failed to save session data:",e)}}function B(){localStorage.removeItem(S)}const D={"10s":1e4,"20s":2e4,"30s":3e4,"40s":4e4,"50s":5e4,"1m":6e4,"2m":12e4,"3m":18e4,"4m":24e4,"5m":3e5};let k=[];const L=[],M=[];let T={"10s":{current:0,best:0},"20s":{current:0,best:0},"30s":{current:0,best:0},"40s":{current:0,best:0},"50s":{current:0,best:0},"1m":{current:0,best:0},"2m":{current:0,best:0},"3m":{current:0,best:0},"4m":{current:0,best:0},"5m":{current:0,best:0}};function N(){if(e)try{e.textContent=T["10s"].current||"--",t.textContent=T["10s"].best||"--",n.textContent=T["20s"].current||"--",a.textContent=T["20s"].best||"--",o.textContent=T["30s"].current||"--",r.textContent=T["30s"].best||"--",i.textContent=T["40s"].current||"--",s.textContent=T["40s"].best||"--",c.textContent=T["50s"].current||"--",l.textContent=T["50s"].best||"--",d.textContent=T["1m"].current||"--",u.textContent=T["1m"].best||"--",m.textContent=T["2m"].current||"--",g.textContent=T["2m"].best||"--",p.textContent=T["3m"].current||"--",h.textContent=T["3m"].best||"--",w.textContent=T["4m"].current||"--",v.textContent=T["4m"].best||"--",A.textContent=T["5m"].current||"--",f.textContent=T["5m"].best||"--"}catch(e){console.error("Error updating power averages display:",e.message)}}function Q(){for(let e of(k=[],Object.keys(T)))T[e].current=0,T[e].best=0;N()}const U={powerValueElement:null,hrValueElement:null,cadenceValueElement:null,deviceNameElement:null,hrDeviceName:null,cadenceDeviceName:null,statusText:null,hrStatusText:null,cadenceStatusText:null,hrConnectionStatus:null,cadenceConnectionStatus:null,powerMeterConnectButton:null,hrConnectButton:null,speedCadenceConnectButton:null,exportButtons:{json:null,csv:null,tcx:null,image:null,clearSession:null},powerAveragesSection:null,hamburgerBtn:null,menuDropdown:null,powerAveragesToggle:null,powerMetricToggle:null,heartRateMetricToggle:null,cadenceMetricToggle:null,showInfoMenuItem:null,powerCard:null,heartRateCard:null,cadenceCard:null};function P(){U.powerValueElement&&(U.powerValueElement.textContent="--"),U.hrValueElement&&(U.hrValueElement.textContent="--"),U.cadenceValueElement&&(U.cadenceValueElement.textContent="--")}function R(){let e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`}async function V(){if(!("wakeLock"in navigator))return console.warn("Wake Lock API is not supported in this browser"),!1;try{return(await navigator.wakeLock.request("screen")).addEventListener("release",()=>{console.log("Screen wake lock was released")}),console.log("Screen wake lock acquired"),!0}catch(e){return console.error("Failed to acquire wake lock:",e.name,e.message),!1}}const Y="cycling_power",W="cycling_speed_and_cadence";let F=null,O=null,H=null,J=null,q=null,j=null,z=null,Z=0,G=0,K=null;async function X(e,t){if(await V(),!navigator.bluetooth)return e.onStatusUpdate("Web Bluetooth API is not available."),!1;try{if(e.onStatusUpdate("Scanning for power meters..."),F&&(J&&(F.removeEventListener("gattserverdisconnected",J),J=null),F.gatt.connected&&F.gatt.disconnect(),F=null),!(F=await navigator.bluetooth.requestDevice({filters:[{services:[Y]}]})))throw Error("No device selected");e.onStatusUpdate("Connecting to device..."),t.deviceNameElement&&(t.deviceNameElement.textContent=`Device: ${F.name||"Unknown Device"}`),J=()=>{var n,a;n=e,a=t,n.onStatusUpdate("Power meter disconnected."),a.deviceNameElement&&(a.deviceNameElement.textContent=""),F&&J&&(F.removeEventListener("gattserverdisconnected",J),J=null),F=null,n.onDisconnected()},F.addEventListener("gattserverdisconnected",J);let n=await F.gatt.connect(),a=await n.getPrimaryService(Y),o=await a.getCharacteristic("cycling_power_measurement");try{let e=await a.getCharacteristic("cycling_power_feature");await e.readValue()}catch{}return await o.startNotifications(),o.addEventListener("characteristicvaluechanged",t=>{!function(e,t){try{let n=e.target.value;if(!n||!(n instanceof DataView))return void console.error("Invalid power measurement data: value must be a DataView");if(n.byteLength<4)return void console.error(`Invalid power measurement data: insufficient data (${n.byteLength} bytes)`);let a=n.getInt16(2,!0);if(isNaN(a))return void console.error("Invalid power value: NaN");a>3e3?console.warn(`Unusually high power detected: ${a}W`):a<-500&&console.warn(`Unusually low power detected: ${a}W`),t.onPowerMeasurement(a)}catch(e){console.error("Error parsing power measurement data:",e.message)}}(t,e)}),e.onStatusUpdate("Connected and receiving data!"),!0}catch(t){return"NotFoundError"===t.name?e.onStatusUpdate("No device selected."):(e.onStatusUpdate(`Error: ${t.message}`),console.error("Power meter connection failed:",t)),F&&(J&&(F.removeEventListener("gattserverdisconnected",J),J=null),F=null),!1}}async function $(e,t){if(await V(),!navigator.bluetooth)return e.onStatusUpdate("Web Bluetooth API is not available."),!1;try{if(e.onStatusUpdate("Scanning for devices..."),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Connecting..."),O){if(j&&z){try{j.removeEventListener("characteristicvaluechanged",z)}catch(e){console.warn("Error removing HR characteristic listener:",e)}z=null,j=null}q&&(O.removeEventListener("gattserverdisconnected",q),q=null),O.gatt.connected&&O.gatt.disconnect(),O=null}if(!(O=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["device_information","battery_service"]})))throw Error("No device selected");return await _(O,e,t),!0}catch(n){if("NotFoundError"===n.name?(e.onStatusUpdate("No device selected."),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Disconnected")):(e.onStatusUpdate(`Error: ${n.message}`),t.hrConnectionStatus&&(t.hrConnectionStatus.textContent="Connection Failed"),console.error("Heart rate monitor connection failed:",n)),j&&z){try{j.removeEventListener("characteristicvaluechanged",z)}catch(e){}z=null,j=null}return O&&q&&(O.removeEventListener("gattserverdisconnected",q),q=null),O=null,!1}}async function _(e,t,n){t.onStatusUpdate("Connecting to device..."),q=()=>{var e=t,a=n;if(e.onStatusUpdate("Heart rate monitor disconnected."),a.hrConnectionStatus&&(a.hrConnectionStatus.textContent="Disconnected"),a.hrDeviceName&&(a.hrDeviceName.textContent=""),j&&z){try{j.removeEventListener("characteristicvaluechanged",z)}catch(e){console.warn("Error removing HR characteristic listener on disconnect:",e)}z=null,j=null}O&&q&&(O.removeEventListener("gattserverdisconnected",q),q=null),O=null,e.onHeartRateChange(0),e.onDisconnected&&e.onDisconnected()},e.addEventListener("gattserverdisconnected",q);try{let a=e.gatt.connected?e.gatt:await e.gatt.connect(),o=await ee(e);n.hrDeviceName&&(n.hrDeviceName.textContent=`Device: ${o}`);let r=await a.getPrimaryService("heart_rate");if(j=await r.getCharacteristic("heart_rate_measurement"),z)try{j.removeEventListener("characteristicvaluechanged",z)}catch(e){console.warn("Error removing old HR characteristic listener:",e)}await j.startNotifications(),z=e=>{!function(e,t){try{let n=e.target.value,a=function(e){if(!e||!(e instanceof DataView))throw Error("Invalid heart rate data: value must be a DataView");if(e.byteLength<2)throw Error(`Invalid heart rate data: insufficient data (${e.byteLength} bytes)`);let t=e.getUint8(0);if((1&t)!=0){if(e.byteLength<3)throw Error(`Invalid heart rate data: insufficient data for UINT16 format (${e.byteLength} bytes)`);let t=e.getUint16(1,!0);return t>300&&console.warn(`Unusually high heart rate detected: ${t} BPM`),t}let n=e.getUint8(1);return n>250&&console.warn(`Unusually high heart rate detected: ${n} BPM`),n}(n);if(isNaN(a)||a<0)return void console.error("Invalid heart rate value:",a);t.onHeartRateChange(a)}catch(e){console.error("Error parsing heart rate data:",e.message)}}(e,t)},j.addEventListener("characteristicvaluechanged",z),t.onStatusUpdate("Connected!"),n.hrConnectionStatus&&(n.hrConnectionStatus.textContent="Connected")}catch(t){if(j&&z){try{j.removeEventListener("characteristicvaluechanged",z)}catch(e){}z=null,j=null}throw e.removeEventListener("gattserverdisconnected",q),q=null,t}}async function ee(e){let t=e.name||"Unknown Device";try{let n=e.gatt.connected?e.gatt:await e.gatt.connect();try{let e=await n.getPrimaryService("device_information"),a=await et(e,"manufacturer_name_string");a&&(t+=` (${a})`);let o=await et(e,"model_number_string");o&&(t+=` ${o}`)}catch(e){}}catch(e){}return e.id&&(t+=` [${e.id.slice(-6)}]`),t}async function et(e,t){try{let n=await e.getCharacteristic(t),a=await n.readValue();return new TextDecoder().decode(a)}catch(e){return null}}async function en(e,t){if(await V(),!navigator.bluetooth)return void e.onStatusUpdate("Web Bluetooth API is not available.");try{e.onStatusUpdate("Scanning for sensors..."),t.cadenceConnectionStatus&&(t.cadenceConnectionStatus.textContent="Connecting..."),K&&(clearTimeout(K),K=null),Z=0,G=0,H=await navigator.bluetooth.requestDevice({filters:[{services:[W]}]}),e.onStatusUpdate("Connecting to device..."),t.cadenceDeviceName&&(t.cadenceDeviceName.textContent=`Device: ${H.name}`),H.addEventListener("gattserverdisconnected",()=>{var n,a;n=e,a=t,n.onStatusUpdate("Device disconnected."),a.cadenceConnectionStatus&&(a.cadenceConnectionStatus.textContent="Disconnected"),a.cadenceDeviceName&&(a.cadenceDeviceName.textContent=""),H=null,n.onCadenceChange(0),n.onDisconnected&&n.onDisconnected(),K&&(clearTimeout(K),K=null),Z=0,G=0});let n=await H.gatt.connect(),a=await n.getPrimaryService(W),o=await a.getCharacteristic("csc_measurement");return await o.startNotifications(),o.addEventListener("characteristicvaluechanged",t=>{!function(e,t){let n=e.target.value,a=n.getUint8(0),o=1;if(1&a&&(o+=6),2&a){let e=n.getUint16(o,!0),a=n.getUint16(o+2,!0);if(Z>0){let n=e-Z,o=(a-G)/1024;if(o>0){let e=Math.round(n/o*60);t.onCadenceChange(e),K&&clearTimeout(K),K=setTimeout(()=>{t.onCadenceChange(0),K=null},3e3)}}Z=e,G=a}}(t,e)}),e.onStatusUpdate("Connected!"),t.cadenceConnectionStatus&&(t.cadenceConnectionStatus.textContent="Connected"),!0}catch(n){return e.onStatusUpdate(`Error: ${n.message}`),t.cadenceConnectionStatus&&(t.cadenceConnectionStatus.textContent="Connection Failed"),console.error("Speed/Cadence connection failed:",n),!1}}function ea(){return F&&F.gatt.connected}function eo(){return O&&O.gatt.connected}function er(){return H&&H.gatt.connected}function ei(e){return void 0!==e.power&&e.power>0}function es(e){let t={time:e=>`<Time>${new Date(e).toISOString()}</Time>`,heartRate:e=>`<HeartRateBpm>
      <Value>${Math.round(e)}</Value>
    </HeartRateBpm>`,cadence:e=>`<Cadence>${Math.round(e)}</Cadence>`,power:e=>{let t=Math.max(0,Math.min(2e3,Math.round(e)));return`<Extensions>
      <TPX xmlns="http://www.garmin.com/xmlschemas/ActivityExtension/v2">
        <Watts>${t}</Watts>
      </TPX>
    </Extensions>`}},n=Object.keys(t).map(n=>void 0===e[n]?"":t[n](e[n])).filter(Boolean).join("\n");return`<Trackpoint>
${n}
</Trackpoint>`}function ec(e){return{time:e.timestamp,...void 0!==e.power&&{power:e.power},...void 0!==e.heartRate&&{heartRate:e.heartRate},...void 0!==e.cadence&&{cadence:e.cadence}}}function el(e){if(!e)throw Error("Power data is null or undefined");if(!Array.isArray(e))throw Error("Power data must be an array");if(0===e.length)throw Error("Power data array is empty");let t=e.filter(e=>!e||"object"!=typeof e||void 0===e.timestamp);if(t.length>0)throw Error(`Power data contains ${t.length} invalid item(s)`);return!0}function ed(e){el(e),eg(new Blob([JSON.stringify({mainSensors:e},null,2)],{type:"application/json;charset=utf-8;"}),`power_data_${R()}.json`)}function eu(e){el(e);let t="timestamp,power,heartRate,cadence\n";e.forEach(e=>{let n=e.timestamp??"",a=e.power??"",o=e.heartRate??"",r=e.cadence??"";t+=`${n},${a},${o},${r}
`}),eg(new Blob([t],{type:"text/csv;charset=utf-8;"}),`power_data_${R()}.csv`)}function em(e){el(e);try{let t=function(e){if(!Array.isArray(e)||0===e.length)return"";let t=e.filter(e=>{var t;return e&&"object"==typeof e&&void 0!==(t=e.timestamp)&&!isNaN(new Date(t).getTime())});if(0===t.length)return"";let n=function(e){let t=[...e];for(;t.length>0&&!ei(t[0]);)t.shift();for(;t.length>0&&!ei(t[t.length-1]);)t.pop();return t}(t.map(ec).sort((e,t)=>e.time-t.time));if(0===n.length)return"";let a=n.map(es).join("\n"),o=new Date(n[0].time).toISOString(),r=function(e){if(0===e.length)return 0;let t=e[0].time;return Math.round((e[e.length-1].time-t)/1e3)}(n);return`<?xml version="1.0" encoding="UTF-8"?>
<TrainingCenterDatabase
  xmlns="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2
    http://www.garmin.com/xmlschemas/TrainingCenterDatabasev2.xsd">
  <Activities>
    <Activity Sport="Biking">
      <Id>${o}</Id>
      <Lap StartTime="${o}">
        <TotalTimeSeconds>${r}</TotalTimeSeconds>
        <DistanceMeters>0</DistanceMeters>
        <Calories>0</Calories>
        <Intensity>Active</Intensity>
        <TriggerMethod>Manual</TriggerMethod>
        <Track>
${a}
        </Track>
      </Lap>
    </Activity>
  </Activities>
</TrainingCenterDatabase>`}(e);if(!t)throw Error("Failed to generate TCX content");let n=new Blob([t],{type:"application/vnd.garmin.tcx+xml;charset=utf-8;"});eg(n,`power_data_${R()}.tcx`)}catch(e){throw console.error("Error generating TCX:",e),e}}function eg(e,t){try{if(!e||!(e instanceof Blob))throw Error("Invalid blob provided for download");if(!t||"string"!=typeof t)throw Error("Invalid filename provided for download");let n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(e){throw console.error("Error during file download:",e),e}}async function ep(e){let{powerData:t}=e;el(t);let n=[];for(let{name:e,fn:a}of[{name:"Summary JSON",fn:()=>ed(t)},{name:"Summary CSV",fn:()=>eu(t)},{name:"TCX",fn:()=>em(t)}]){try{a(),console.log(`\u{2713} ${e} exported`)}catch(t){n.push(`${e}: ${t.message}`)}await new Promise(e=>setTimeout(e,100))}if(n.length>0){let e=`Some exports failed:
${n.join("\n")}`;throw console.warn("Export errors:",n),Error(e)}console.log("✅ All exports completed successfully!")}function eh(e,t){let n=`Error during ${t} export: ${e.message}`;console.error(n,e),alert(n)}async function ew(){try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>(console.log("Deleting cache:",e),caches.delete(e)))),console.log("All caches cleared")}if(navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),navigator.serviceWorker)for(let e of(await navigator.serviceWorker.getRegistrations()))await e.unregister(),console.log("Service worker unregistered")}catch(e){console.error("Error clearing cache:",e)}}function ev(e,t){let n=document.createElement("div");return n.className="export-modal",n.innerHTML=`
        <div class="export-modal-content">
            <div class="export-modal-header">
                <h3 class="export-modal-title">${e}</h3>
                <button class="export-modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="export-modal-description">${t}</div>
            <div class="export-modal-buttons"></div>
        </div>
    `,n.querySelector(".export-modal-close").addEventListener("click",()=>eC(n)),n.addEventListener("click",e=>{e.target===n&&eC(n)}),n}function eA(e,t){let n=e.querySelector(".export-modal-buttons");t.forEach(e=>{let t=document.createElement("button");if(t.className=`export-modal-button ${e.className||""}`,t.disabled=e.disabled||!1,t.innerHTML=`
            <span>${e.text}</span>
            ${e.description?`<small style="opacity: 0.7; font-size: 0.8em;">${e.description}</small>`:""}
        `,t.addEventListener("click",e.onClick),n.appendChild(t),e.className&&e.className.includes("export-all")){let e=document.createElement("div");e.className="export-modal-separator",e.innerHTML="<span>Individual Exports</span>",n.appendChild(e)}})}function ef(e){document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("show")})}function eC(e){e.classList.remove("show"),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},300)}function ey(e,t,n=!0,a=null){let o=n;n?(e.classList.add("active"),t.style.display="block"):(e.classList.remove("active"),t.style.display="none");let r=()=>{(o=!o)?(t.style.display="block",e.classList.add("active")):(t.style.display="none",e.classList.remove("active")),a&&a()};return e.addEventListener("click",r),()=>e.removeEventListener("click",r)}function eE(){let e=document.querySelector(".dashboard");if(!e)return;let t=document.querySelector(".collapsed-sections-row");t&&(t.querySelectorAll(".power-averages-section").forEach(t=>{e.parentNode.insertBefore(t,e.nextSibling)}),t.remove()),e.classList.remove("has-collapsed-sections")}function eb(e,t){let n=document.createElement("div");n.className="metric-info-modal",n.innerHTML=`
        <div class="metric-info-content">
            <div class="metric-info-header">
                <h3>${e}</h3>
                <button class="metric-info-close" aria-label="Close">\xd7</button>
            </div>
            <div class="metric-info-body">
                <p>${t}</p>
            </div>
        </div>
    `,document.body.appendChild(n),setTimeout(()=>n.classList.add("active"),10);let a=n.querySelector(".metric-info-close"),o=()=>{n.classList.remove("active"),setTimeout(()=>n.remove(),300)};a.addEventListener("click",o),n.addEventListener("click",e=>{e.target===n&&o()});let r=e=>{"Escape"===e.key&&(o(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r)}function eI(){alert("Layout is fixed: Power on top, HR and Cadence in middle, Power Averages at bottom")}let eS=[],ex=0,eB=0,eD=0,ek=null,eL=null,eM=null;const eT={get powerData(){return eS},get lastPowerValue(){return ex},get lastHeartRateValue(){return eB},get lastCadenceValue(){return eD},get sessionStartTime(){return ek},resetAllSessionData:function(){eS.length=0,Q(),ex=0,eB=0,eD=0,ek=null,P(),B()},elements:U},eN={onPowerMeasurement:e=>{!function(e){if(!U.powerValueElement)return;let t=e||"--";U.powerValueElement.textContent=t,U.powerValueElement.setAttribute("data-value",t)}(e),ex=e,function(e){if("number"!=typeof e||isNaN(e))return console.error("Invalid power reading: must be a number",e);e>3e3?console.warn(`Unusually high power reading: ${e}W`):e<-500&&console.warn(`Unusually low power reading: ${e}W`);let t=Date.now();k.push({timestamp:t,power:e});let n=t-36e4;if(k=k.filter(e=>e.timestamp>n),L.push({timestamp:t,power:e}),L.length>0&&L[0].timestamp<=t-1e4){let e=Math.round(L.reduce((e,t)=>e+t.power,0)/L.length);for(M.push(e),L.splice(0,L.length);M.length>30;)M.shift();for(let[e,t]of Object.entries(D)){let n=Math.ceil(t/1e4);if(M.length>=n){let t=Math.round(M.slice(-n).reduce((e,t)=>e+t,0)/n);T[e].current=t,t>T[e].best&&(T[e].best=t)}else T[e].current=0}N()}}(e)},onDisconnected:()=>{P(),Q(),eL&&(clearInterval(eL),eL=null),ex=0,eP()},onStatusUpdate:e=>{U.statusText&&(U.statusText.textContent=e)}},eQ={onHeartRateChange:e=>{U.hrValueElement&&(U.hrValueElement.textContent=e),eB=e},onStatusUpdate:e=>{U.hrStatusText&&(U.hrStatusText.textContent=e)},onDisconnected:()=>{eP()}},eU={onCadenceChange:e=>{U.cadenceValueElement&&(U.cadenceValueElement.textContent=e),eD=e},onStatusUpdate:e=>{U.cadenceStatusText&&(U.cadenceStatusText.textContent=e)},onDisconnected:()=>{eP()}};function eP(){var e;e={powerMeter:ea(),heartRate:eo(),speedCadence:er()},U.powerMeterConnectButton&&U.powerMeterConnectButton.setAttribute("data-connected",e.powerMeter?"true":"false"),U.hrConnectButton&&U.hrConnectButton.setAttribute("data-connected",e.heartRate?"true":"false"),U.speedCadenceConnectButton&&U.speedCadenceConnectButton.setAttribute("data-connected",e.speedCadence?"true":"false"),U.powerAveragesSection&&U.powerAveragesSection.setAttribute("data-connected",e.powerMeter?"true":"false")}async function eR(){try{console.log("Layout initialized: Fixed 3-row layout"),U.powerValueElement=document.getElementById("power-value"),U.hrValueElement=document.getElementById("hr-value"),U.cadenceValueElement=document.getElementById("cadence-value"),U.deviceNameElement=document.getElementById("device-name"),U.hrDeviceName=document.getElementById("hrDeviceName"),U.cadenceDeviceName=document.getElementById("cadenceDeviceName"),U.statusText=document.getElementById("status"),U.hrStatusText=document.getElementById("hrStatus"),U.cadenceStatusText=document.getElementById("cadenceStatus"),U.hrConnectionStatus=document.getElementById("hrConnectionStatus"),U.cadenceConnectionStatus=document.getElementById("cadenceConnectionStatus"),U.powerMeterConnectButton=document.getElementById("connectButton"),U.hrConnectButton=document.getElementById("hrConnectButton"),U.speedCadenceConnectButton=document.getElementById("speedCadenceConnectButton"),U.powerAveragesSection=document.getElementById("powerAveragesSection"),U.hamburgerBtn=document.getElementById("hamburgerButton"),U.menuDropdown=document.getElementById("menuDropdown"),U.powerAveragesToggle=document.getElementById("powerAveragesToggle"),U.powerMetricToggle=document.getElementById("powerMetricToggle"),U.heartRateMetricToggle=document.getElementById("heartRateMetricToggle"),U.cadenceMetricToggle=document.getElementById("cadenceMetricToggle"),U.showInfoMenuItem=document.getElementById("showInfoMenuItem"),U.powerCard=document.querySelector(".power-card"),U.heartRateCard=document.querySelector(".hr-card"),U.cadenceCard=document.querySelector(".cadence-card"),U.hrConnectionStatus&&(U.hrConnectionStatus.textContent="Disconnected"),U.cadenceConnectionStatus&&(U.cadenceConnectionStatus.textContent="Disconnected"),e=document.getElementById("avg10s-current"),t=document.getElementById("avg10s-best"),n=document.getElementById("avg20s-current"),a=document.getElementById("avg20s-best"),o=document.getElementById("avg30s-current"),r=document.getElementById("avg30s-best"),i=document.getElementById("avg40s-current"),s=document.getElementById("avg40s-best"),c=document.getElementById("avg50s-current"),l=document.getElementById("avg50s-best"),d=document.getElementById("avg1m-current"),u=document.getElementById("avg1m-best"),m=document.getElementById("avg2m-current"),g=document.getElementById("avg2m-best"),p=document.getElementById("avg3m-current"),h=document.getElementById("avg3m-best"),w=document.getElementById("avg4m-current"),v=document.getElementById("avg4m-best"),A=document.getElementById("avg5m-current"),f=document.getElementById("avg5m-best"),U.powerAveragesSection&&(U.powerAveragesSection.style.display="block");let C=document.querySelector(".dashboard"),y=document.getElementById("powerAveragesSection"),E=y&&"none"===y.style.display;C&&(E?C.classList.add("maximized"):C.classList.remove("maximized")),eE();let b=document.getElementById("powerIcon");b&&b.addEventListener("click",e=>{e.preventDefault(),eb("⚡ Power Output","Power output is measured in Watts and represents the amount of work you are doing on the bike. It is calculated by measuring the force applied to the pedals and the speed of pedaling. Higher power output means you are working harder. This metric is the most accurate way to measure cycling effort.")});let I=document.getElementById("hrIcon");I&&I.addEventListener("click",e=>{e.preventDefault(),eb("❤️ Heart Rate","Heart rate is measured in beats per minute (BPM) and indicates how hard your cardiovascular system is working. Your heart rate increases as exercise intensity increases. Monitoring heart rate helps you train in specific zones for different fitness goals. Connect a Bluetooth heart rate monitor to track this metric.")});let D=document.getElementById("cadenceIcon");D&&D.addEventListener("click",e=>{e.preventDefault(),eb("\uD83D\uDEB4 Cadence","Cadence is measured in revolutions per minute (RPM) and represents how fast you are pedaling. Most cyclists aim for a cadence between 80-100 RPM for optimal efficiency. Higher cadence with lower resistance can reduce muscle fatigue, while lower cadence with higher resistance builds strength. Connect a speed & cadence sensor to track this metric.")}),function(e){if(!e.hamburgerBtn||!e.menuDropdown)return console.error("Hamburger menu elements not found:",{hamburgerBtn:!!e.hamburgerBtn,menuDropdown:!!e.menuDropdown});e.hamburgerBtn.addEventListener("click",function(){e.menuDropdown.classList.contains("active")?e.menuDropdown.classList.remove("active"):e.menuDropdown.classList.add("active")}),document.addEventListener("click",function(t){t.target.closest(".hamburger-menu")||e.menuDropdown.classList.remove("active")})}(U),function(e){if(!e.powerAveragesToggle||!e.powerAveragesSection)return console.error("Power averages toggle elements not found:",{powerAveragesToggle:!!e.powerAveragesToggle,powerAveragesSection:!!e.powerAveragesSection});ey(e.powerAveragesToggle,e.powerAveragesSection,!0,eE)}(U),U.powerMetricToggle&&U.powerCard?ey(U.powerMetricToggle,U.powerCard,!0):console.error("Power metric toggle elements not found"),U.heartRateMetricToggle&&U.heartRateCard?ey(U.heartRateMetricToggle,U.heartRateCard,!0):console.error("Heart rate metric toggle elements not found"),U.cadenceMetricToggle&&U.cadenceCard?ey(U.cadenceMetricToggle,U.cadenceCard,!0):console.error("Cadence metric toggle elements not found");U.showInfoMenuItem?U.showInfoMenuItem.addEventListener("click",function(){!function(){let e=document.createElement("div");e.className="modal-backdrop",e.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    `;let t=document.createElement("div");t.className="modal",t.style.cssText=`
        background: #1a1a2e;
        border-radius: 12px;
        padding: 2rem;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        margin: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    `;let n=document.createElement("canvas");n.width=200,n.height=200,n.style.cssText=`
        background: white;
        border-radius: 8px;
        margin: 1rem auto;
        max-width: 100%;
        height: auto;
        display: block;
    `,t.innerHTML=`
        <div style="text-align: center; margin-bottom: 1.5rem;">
            <h2 style="color: #3498db; margin: 0 0 0.5rem 0; font-size: 1.8rem;">\u{1F6B4} Web Bluetooth Power Meter</h2>
            <p style="color: #cccccc; margin: 0; font-size: 1rem;">Real-time cycling data analysis</p>
        </div>

        <div style="color: #ffffff; line-height: 1.6;">
            <h3 style="color: #f39c12; margin: 1.5rem 0 1rem 0;">\u{1F4F1} Share This App</h3>
            <div style="text-align: center; margin-bottom: 1rem;">
                <div id="qr-container" style="margin: 1rem 0;"></div>
                <p style="color: #ffffff; margin: 0.5rem 0; font-weight: 600;">Scan to access on any device</p>
                <a href="https://colscoding.github.io/power-saver/" target="_blank" style="
                    color: #9b59b6; 
                    text-decoration: none; 
                    font-size: 0.9rem;
                    word-break: break-all;
                    line-height: 1.4;
                ">https://colscoding.github.io/power-saver/</a>
            </div>

            <h3 style="color: #f39c12; margin: 1.5rem 0 1rem 0;">\u{1F4F1} What is this app?</h3>
            <p style="margin-bottom: 1rem;">
                This is a web-based power meter application that connects to Bluetooth devices:
            </p>
            <ul style="margin: 0 0 1rem 1rem; padding-left: 1rem;">
                <li>cycling power meter</li>
                <li>cadence sensor</li>
                <li>heart rate sensor</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <button id="closeInfoModal" style="
                background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            ">Got it!</button>
        </div>
    `,t.querySelector("#qr-container").appendChild(n),function(e){let t=e.getContext("2d"),n=e.width;t.fillStyle="#ffffff",t.fillRect(0,0,n,n);let a=new Image;a.onload=function(){t.drawImage(a,0,0,n,n)},a.onerror=function(){var e=t,a=n;e.fillStyle="#000000",e.font="12px Arial",e.textAlign="center";let o=a/25;for(let t=0;t<25;t++)for(let n=0;n<25;n++)((t+n)%3==0||0===t||24===t||0===n||24===n)&&e.fillRect(t*o,n*o,o,o);e.fillStyle="#ffffff",e.fillRect(.2*a,.4*a,.6*a,.2*a),e.fillStyle="#000000",e.fillText("QR Code",a/2,a/2-10),e.fillText("Unavailable",a/2,a/2+10)},a.src="data:image/png;base64,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"}(n),e.appendChild(t),document.body.appendChild(e);let a=t.querySelector("#closeInfoModal"),o=()=>{document.body.removeChild(e)};a.addEventListener("click",o),e.addEventListener("click",t=>{t.target===e&&o()});let r=e=>{"Escape"===e.key&&(o(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-2px)",a.style.boxShadow="0 8px 24px rgba(52, 152, 219, 0.4)"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})}(),U.menuDropdown&&U.menuDropdown.classList.remove("active")}):console.error("Show info menu item not found");let k=document.getElementById("layoutMenuItem");k&&eI&&k.addEventListener("click",function(){eI(),U.menuDropdown&&U.menuDropdown.classList.remove("active")}),U.powerMeterConnectButton&&U.powerMeterConnectButton.addEventListener("click",async()=>{if(ea()){confirm("Disconnect power meter?")&&F&&F.gatt.connected&&F.gatt.disconnect();return}eS.length=0,ex=0,Q(),eL&&clearInterval(eL),await X(eN,U)&&(ek||(ek=Date.now()),eL=setInterval(()=>{eS.push({timestamp:Date.now(),power:ex,heartRate:eB,cadence:eD}),eS.length%100==0&&x(eT)},100),eP())}),U.hrConnectButton&&U.hrConnectButton.addEventListener("click",async()=>{if(eo()){confirm("Disconnect heart rate monitor?")&&O&&O.gatt.connected&&O.gatt.disconnect();return}await $(eQ,U)&&eP()}),U.speedCadenceConnectButton&&U.speedCadenceConnectButton.addEventListener("click",async()=>{if(er()){confirm("Disconnect cadence sensor?")&&H&&H.gatt.connected&&H.gatt.disconnect();return}await en(eU,U)&&eP()});let L=document.getElementById("exportMenuItem");L&&L.addEventListener("click",()=>{let e=ev("\uD83D\uDCC4 Exports","Export your session data in various formats"),t=[{text:"\uD83D\uDCE5 Export All Files",description:"Download all export formats at once",className:"export-all primary",onClick:async()=>{try{await ep({powerData:eT.powerData}),eC(e),alert("All export files downloaded successfully!")}catch(e){eh(e,"all files")}}},{text:"\uD83D\uDCCA Export JSON",description:"JavaScript Object Notation format",onClick:()=>{try{ed(eT.powerData),eC(e)}catch(e){eh(e,"JSON")}}},{text:"\uD83D\uDCCA Export CSV",description:"Comma-Separated Values format",onClick:()=>{try{eu(eT.powerData),eC(e)}catch(e){eh(e,"CSV")}}},{text:"\uD83C\uDFC3 Export TCX",description:"Training Center XML format",onClick:()=>{try{em(eT.powerData),eC(e)}catch(e){eh(e,"TCX")}}}];eA(e,t),ef(e)});let M=document.getElementById("exportUtilsMenuItem");M&&M.addEventListener("click",()=>{let e=ev("\uD83D\uDEE0️ Utilities","Session management and utilities"),t=[{text:"� Clear App Cache",description:"Clear cached files and force reload (ensures fresh version)",className:"primary",onClick:async()=>{confirm("This will clear the app cache and reload to get the latest version. Continue?")&&(await ew(),alert("Cache cleared! The page will now reload."),window.location.reload(!0))}},{text:"�\uD83D\uDDD1️ Clear Session Data",description:"Clear all session data (cannot be undone)",className:"danger",onClick:()=>{confirm("Are you sure you want to clear all session data? This action cannot be undone.")&&(eT.resetAllSessionData(),alert("Session data cleared successfully!"),eC(e))}}];eA(e,t),ef(e)}),eP();let T=function(){try{let e=localStorage.getItem(S);if(!e)return null;let t=JSON.parse(e);if(!(t&&"object"==typeof t&&t.timestamp&&t.powerData&&Array.isArray(t.powerData)&&1))return console.warn("Invalid session data structure, clearing..."),localStorage.removeItem(S),null;if(Date.now()-t.timestamp>864e5)return console.log("Session expired, clearing..."),localStorage.removeItem(S),null;return t}catch(e){return console.warn("Failed to load session data:",e),localStorage.removeItem(S),null}}();T&&await new Promise(e=>{let t=document.createElement("div");t.className="modal-backdrop";let n=document.createElement("div");n.className="modal";let a=Math.round((Date.now()-T.timestamp)/6e4),o=T.powerData?.length||0;n.innerHTML=`
      <h3>Previous Session Found</h3>
      <p>
        A previous session was found from ${a} minutes ago with ${o} data points.
      </p>
      <p>
        Would you like to restore this session or start fresh?
      </p>
      <div class="modal-buttons">
        <button id="startFresh" class="modal-button secondary">Start Fresh</button>
        <button id="restoreSession" class="modal-button primary">Restore Session</button>
      </div>
    `,t.appendChild(n),document.body.appendChild(t),n.querySelector("#startFresh").addEventListener("click",()=>{document.body.removeChild(t),B(),e(!1)}),n.querySelector("#restoreSession").addEventListener("click",()=>{document.body.removeChild(t),e(!0)}),t.addEventListener("click",n=>{n.target===t&&(document.body.removeChild(t),e(!1))})})?function(e){try{var t;e.powerData&&(eS.length=0,eS.push(...e.powerData)),void 0!==e.lastPowerValue&&(ex=e.lastPowerValue),void 0!==e.lastHeartRateValue&&(eB=e.lastHeartRateValue),void 0!==e.lastCadenceValue&&(eD=e.lastCadenceValue),void 0!==e.sessionStartTime&&(ek=e.sessionStartTime),void 0!==(t={power:ex,heartRate:eB,cadence:eD}).power&&U.powerValueElement&&(U.powerValueElement.textContent=t.power||"--"),void 0!==t.heartRate&&U.hrValueElement&&(U.hrValueElement.textContent=t.heartRate||"--"),void 0!==t.cadence&&U.cadenceValueElement&&(U.cadenceValueElement.textContent=t.cadence||"--"),N(),eS.length>0&&function(e){if(!document.getElementById("notification-styles")){let e=document.createElement("style");e.id="notification-styles",e.textContent=`
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `,document.head.appendChild(e)}let t=function(e,t){let n=document.createElement("div");return n.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${t};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        z-index: 1000;
        font-size: 0.9rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease-out;
        max-width: 300px;
        word-wrap: break-word;
    `,n.textContent=e,n}(`Session restored! ${e} data points recovered.`,"#4CAF50");document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideIn 0.3s ease-out reverse",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},5e3)}(eS.length)}catch(e){return console.warn("Failed to restore session data:",e),!1}}(T):ek=Date.now(),window.addEventListener("beforeunload",eV),eM=setInterval(()=>{eS.length>0&&x(eT)},3e4)}catch(e){console.error("Failed to initialize application:",e),alert("Failed to initialize application. Please refresh the page.")}}function eV(){eS.length>0&&x(eT),eL&&(clearInterval(eL),eL=null),eM&&(clearInterval(eM),eM=null)}document.addEventListener("DOMContentLoaded",()=>{let e,t;eR(),e=0,t=!1,document.body.addEventListener("touchstart",n=>{0===window.scrollY&&(e=n.touches[0].pageY,t=!0)},{passive:!0}),document.body.addEventListener("touchmove",n=>{t&&0===window.scrollY&&n.touches[0].pageY-e>10&&n.preventDefault()},{passive:!1}),document.body.addEventListener("touchend",()=>{t=!1}),window.addEventListener("beforeunload",e=>{if(eS.length>0||ea()||eo()||er()){let t="You have active data or connections. Are you sure you want to refresh?";return e.preventDefault(),e.returnValue=t,t}}),document.body.style.overscrollBehavior="contain"}),function(){if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.port){console.log("[PWA] Development mode detected - skipping service worker registration"),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>{e.unregister(),console.log("[PWA] Unregistered existing service worker for development")})});return}"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{let e=await navigator.serviceWorker.register(I,{updateViaCache:"none"});console.log("[PWA] Service Worker registered:",e.scope),e.update(),setInterval(()=>{console.log("[PWA] Checking for updates..."),e.update()},3e5),e.addEventListener("updatefound",()=>{let t=e.installing;console.log("[PWA] Update found, installing new service worker..."),t.addEventListener("statechange",()=>{var e;"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("[PWA] New version available"),e=t,console.log("[PWA] Update available. New version can be activated."),E||(E=new C),E.show(e)):console.log("[PWA] Content cached for offline use"))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[PWA] Controller changed, reloading page..."),window.location.reload()})}catch(e){console.error("[PWA] Service Worker registration failed:",e)}}):console.warn("[PWA] Service Workers are not supported in this browser")}(),y||(y=new class e{constructor(){this.banner=null,this.deferredPrompt=null}createBanner(){let e=document.createElement("div");return e.id="pwaInstallBanner",e.className="pwa-install-banner",e.innerHTML=`
            <div class="pwa-install-content">
                <div class="pwa-install-icon">\u{26A1}</div>
                <div class="pwa-install-text">
                    <strong>Install Power Meter</strong>
                    <span>Add to home screen for quick access</span>
                </div>
                <div class="pwa-install-actions">
                    <button id="pwaInstallButton" class="pwa-btn pwa-btn-primary">Install</button>
                    <button id="pwaInstallClose" class="pwa-btn pwa-btn-secondary">\xd7</button>
                </div>
            </div>
        `,e}show(e){this.isInstalled()||this.wasRecentlyDismissed()||(this.deferredPrompt=e,this.banner||(this.banner=this.createBanner(),document.body.appendChild(this.banner),this.attachEventListeners()),setTimeout(()=>{this.banner.classList.add("pwa-install-banner-visible")},500))}hide(){this.banner&&(this.banner.classList.remove("pwa-install-banner-visible"),setTimeout(()=>{this.banner&&this.banner.parentNode&&(this.banner.parentNode.removeChild(this.banner),this.banner=null)},300))}attachEventListeners(){let e=this.banner.querySelector("#pwaInstallButton"),t=this.banner.querySelector("#pwaInstallClose");e.addEventListener("click",()=>this.handleInstallClick()),t.addEventListener("click",()=>this.handleCloseClick())}async handleInstallClick(){if(!this.deferredPrompt)return void console.log("[PWA] Install prompt not available");this.deferredPrompt.prompt();let{outcome:e}=await this.deferredPrompt.userChoice;console.log(`[PWA] Install prompt outcome: ${e}`),this.hide(),this.deferredPrompt=null,"accepted"===e&&this.showThankYouMessage()}handleCloseClick(){this.hide(),localStorage.setItem("pwaInstallDismissed",Date.now().toString())}wasRecentlyDismissed(){let e=localStorage.getItem("pwaInstallDismissed");return!!e&&Date.now()-parseInt(e)<6048e5}isInstalled(){return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone}showThankYouMessage(){let e=document.createElement("div");e.className="pwa-toast pwa-toast-success",e.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">\u{2713}</span>
                <span>Thanks for installing! Launch from your home screen.</span>
            </div>
        `,document.body.appendChild(e),setTimeout(()=>e.classList.add("pwa-toast-visible"),100),setTimeout(()=>{e.classList.remove("pwa-toast-visible"),setTimeout(()=>e.remove(),300)},4e3)}}),window.addEventListener("beforeinstallprompt",e=>{console.log("[PWA] Install prompt available"),e.preventDefault(),y.show(e)}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App successfully installed"),y&&y.hide()}),setTimeout(()=>{!function(){let e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=!0===window.navigator.standalone;if(e&&!t){let e=localStorage.getItem("iosInstallDismissed");if(e&&Date.now()-parseInt(e)<2592e5)return;let t=document.createElement("div");t.className="pwa-ios-instructions",t.innerHTML=`
            <div class="pwa-ios-content">
                <div class="pwa-ios-header">
                    <span class="pwa-ios-icon">\u{1F4F1}</span>
                    <strong>Install Power Meter</strong>
                    <button class="pwa-ios-close" id="pwaIOSClose">\xd7</button>
                </div>
                <div class="pwa-ios-steps">
                    <p>Tap <strong>Share</strong> <span style="font-size: 1.2em;">\u{25A1}\u{2191}</span> then <strong>Add to Home Screen</strong></p>
                </div>
            </div>
        `,document.body.appendChild(t),setTimeout(()=>t.classList.add("pwa-ios-instructions-visible"),500),t.querySelector("#pwaIOSClose").addEventListener("click",()=>{t.classList.remove("pwa-ios-instructions-visible"),setTimeout(()=>t.remove(),300),localStorage.setItem("iosInstallDismissed",Date.now().toString())})}}()},2e3),b||(b=new class e{constructor(){this.indicator=null,this.isOnline=navigator.onLine}createIndicator(){let e=document.createElement("div");return e.id="pwaOfflineIndicator",e.className="pwa-offline-indicator",e.innerHTML=`
            <div class="pwa-offline-content">
                <span class="pwa-offline-icon">\u{1F4F4}</span>
                <span class="pwa-offline-text">You're offline</span>
            </div>
        `,e}init(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),navigator.onLine||this.handleOffline()}handleOnline(){this.isOnline=!0,console.log("[PWA] Connection restored"),this.hide(),this.showToast("✓","Back online","success")}handleOffline(){this.isOnline=!1,console.log("[PWA] Connection lost"),this.show()}show(){this.indicator||(this.indicator=this.createIndicator(),document.body.appendChild(this.indicator)),setTimeout(()=>{this.indicator.classList.add("pwa-offline-indicator-visible")},100)}hide(){this.indicator&&(this.indicator.classList.remove("pwa-offline-indicator-visible"),setTimeout(()=>{this.indicator&&this.indicator.parentNode&&(this.indicator.parentNode.removeChild(this.indicator),this.indicator=null)},300))}showToast(e,t,n="info"){let a=document.createElement("div");a.className=`pwa-toast pwa-toast-${n}`,a.innerHTML=`
            <div class="pwa-toast-content">
                <span class="pwa-toast-icon">${e}</span>
                <span>${t}</span>
            </div>
        `,document.body.appendChild(a),setTimeout(()=>a.classList.add("pwa-toast-visible"),100),setTimeout(()=>{a.classList.remove("pwa-toast-visible"),setTimeout(()=>a.remove(),300)},3e3)}}),b.init(),window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone?console.log("[PWA] Running as installed app"):console.log("[PWA] Running in browser");
//# sourceMappingURL=power-saver.bb864aa9.js.map
